<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MECADEPOT ‚Äî ERP</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect rx='20' width='100' height='100' fill='%23f59e0b'/><text x='50' y='72' text-anchor='middle' font-size='60' font-weight='900' fill='%23000'>M</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root{--bg:#f5f6f8;--card:#fff;--sb:#0c111d;--sbh:rgba(255,255,255,.06);--sba:rgba(245,158,11,.12);--inp:#f8f9fb;--hov:#f1f3f7;--t1:#0f172a;--t2:#475569;--t3:#94a3b8;--tw:#fff;--ac:#f59e0b;--ach:#d97706;--acl:rgba(245,158,11,.1);--acb:rgba(245,158,11,.3);--bl:#3b82f6;--bll:#eff6ff;--blb:#bfdbfe;--gn:#10b981;--gnl:#ecfdf5;--gnb:#a7f3d0;--rd:#ef4444;--rdl:#fef2f2;--rdb:#fecaca;--or:#f97316;--orl:#fff7ed;--orb:#fed7aa;--bd:#e2e8f0;--bdd:#cbd5e1;--sh:0 1px 3px rgba(0,0,0,.06);--shl:0 12px 32px rgba(0,0,0,.12);--r:8px;--rl:12px;--sw:256px;--th:56px;--f:'Outfit',system-ui,sans-serif;--mo:'IBM Plex Mono',monospace}
*{margin:0;padding:0;box-sizing:border-box}html,body{font-family:var(--f);font-size:14px;color:var(--t1);background:var(--bg);height:100%;overflow:hidden;-webkit-font-smoothing:antialiased}
::selection{background:var(--ac);color:#000}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:var(--bdd);border-radius:3px}
.screen{display:none;height:100vh}.screen.active{display:flex}
.login-wrap{width:100%;display:flex;height:100vh}
.login-left{flex:1;background:var(--sb);display:flex;align-articles:center;justify-content:center;padding:64px;position:relative;overflow:hidden}
.login-left::before{content:'';position:absolute;width:600px;height:600px;border-radius:50%;background:radial-gradient(circle,rgba(245,158,11,.15),transparent 70%);top:-100px;right:-100px}
.login-brand{position:relative;z-index:1;color:var(--tw);max-width:500px}
.logo-row{display:flex;align-articles:center;gap:14px;margin-bottom:48px}
.logo-mark{width:48px;height:48px;background:var(--ac);border-radius:var(--rl);display:flex;align-articles:center;justify-content:center;font-weight:800;font-size:20px;color:#000}
.logo-text{font-size:20px;font-weight:700;letter-spacing:3px}
.login-brand h1{font-size:40px;font-weight:800;line-height:1.1;margin-bottom:16px}.login-brand h1 span{color:var(--ac)}
.login-brand p{color:rgba(255,255,255,.55);font-size:15px;line-height:1.7;margin-bottom:40px}
.login-pills{display:flex;flex-wrap:wrap;gap:8px}.login-pill{padding:8px 16px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);border-radius:99px;font-size:12px;font-weight:500;color:rgba(255,255,255,.7)}
.login-right{width:480px;display:flex;align-articles:center;justify-content:center;padding:48px;background:var(--card)}
.login-form{width:100%;max-width:360px}.login-form h2{font-size:24px;font-weight:700;margin-bottom:4px}.login-form .sub{color:var(--t2);font-size:13px;margin-bottom:28px}
.fg{margin-bottom:16px}.fg label{display:block;font-size:12px;font-weight:600;color:var(--t2);margin-bottom:5px;text-transform:uppercase;letter-spacing:.5px}
.fg label em{font-style:normal;font-weight:400;color:var(--t3);text-transform:none;letter-spacing:0;font-size:11px}
.fg input,.fg select,.fg textarea{width:100%;padding:10px 14px;border:1.5px solid var(--bd);border-radius:var(--r);font-size:14px;font-family:var(--f);color:var(--t1);background:var(--inp);transition:all .15s}
.fg input:focus,.fg select:focus,.fg textarea:focus{outline:none;border-color:var(--ac);box-shadow:0 0 0 3px var(--acl)}
.fg select{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg width='10' height='6' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0l5 6 5-6' fill='%2394a3b8'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;padding-right:36px}
.btn{display:inline-flex;align-articles:center;justify-content:center;gap:7px;padding:10px 20px;border:none;border-radius:var(--r);font-size:13px;font-weight:600;font-family:var(--f);cursor:pointer;transition:all .15s;white-space:nowrap}
.btn-ac{background:var(--ac);color:#000}.btn-ac:hover{background:var(--ach)}
.btn-bl{background:var(--bl);color:#fff}.btn-bl:hover{background:#2563eb}
.btn-gn{background:var(--gn);color:#fff}.btn-gn:hover{background:#059669}
.btn-rd{background:var(--rd);color:#fff}.btn-rd:hover{background:#dc2626}
.btn-gh{background:transparent;color:var(--t2);border:1.5px solid var(--bd)}.btn-gh:hover{background:var(--hov)}
.btn-sm{padding:6px 14px;font-size:12px}.btn-xs{padding:4px 10px;font-size:11px}.btn-full{width:100%}
.btn-link{background:none;border:none;color:var(--bl);font-weight:600;cursor:pointer;font-family:var(--f);font-size:13px;padding:0}
#app{height:100vh;display:flex}
.sidebar{width:var(--sw);height:100vh;background:var(--sb);display:flex;flex-direction:column;flex-shrink:0}
.sb-head{padding:16px 20px;display:flex;align-articles:center;gap:12px;border-bottom:1px solid rgba(255,255,255,.06)}
.sb-mark{width:34px;height:34px;background:var(--ac);border-radius:var(--r);display:flex;align-articles:center;justify-content:center;font-weight:800;font-size:14px;color:#000}
.sb-title{font-size:14px;font-weight:700;color:var(--tw);letter-spacing:2px}.sb-ctx{font-size:10px;color:var(--ac);font-weight:600;letter-spacing:.5px;margin-top:1px}
.sb-nav{flex:1;overflow-y:auto;padding:8px}
.sb-section{padding:14px 12px 4px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:rgba(255,255,255,.25)}
.sb-item{display:flex;align-articles:center;gap:10px;padding:9px 12px;border-radius:var(--r);color:rgba(255,255,255,.55);cursor:pointer;font-size:13px;transition:all .12s;position:relative;margin-bottom:1px}
.sb-item:hover{background:var(--sbh);color:rgba(255,255,255,.9)}
.sb-item.active{background:var(--sba);color:var(--ac);font-weight:600}
.sb-item.active::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:3px;height:20px;background:var(--ac);border-radius:0 3px 3px 0}
.sb-item .ico{width:18px;text-align:center;font-size:15px;flex-shrink:0}
.sb-item .badge{margin-left:auto;background:var(--rd);color:#fff;font-size:10px;font-weight:700;padding:2px 7px;border-radius:99px}.sb-item .badge.w{background:var(--or)}
.sb-foot{padding:12px 16px;border-top:1px solid rgba(255,255,255,.06);display:flex;align-articles:center;gap:10px}
.sb-avatar{width:32px;height:32px;border-radius:50%;background:var(--ac);color:#000;display:flex;align-articles:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0}
.sb-uname{font-size:12px;font-weight:500;color:rgba(255,255,255,.8)}.sb-urole{font-size:10px;color:rgba(255,255,255,.35)}
.sb-logout{margin-left:auto;cursor:pointer;color:#ef4444;opacity:.6;transition:opacity .15s}.sb-logout:hover{opacity:1}
.main{flex:1;display:flex;flex-direction:column;height:100vh;overflow:hidden;min-width:0}
.topbar{height:var(--th);background:var(--card);border-bottom:1px solid var(--bd);display:flex;align-articles:center;justify-content:space-between;padding:0 24px;flex-shrink:0}
.crumbs{display:flex;align-articles:center;gap:5px;font-size:13px;color:var(--t3)}.crumbs span:last-child{color:var(--t1);font-weight:600}
.tb-right{display:flex;align-articles:center;gap:12px}
.search-box{display:flex;align-articles:center;gap:8px;background:var(--inp);border:1.5px solid var(--bd);border-radius:var(--r);padding:7px 14px;width:280px}
.search-box input{border:none;background:none;font-size:13px;font-family:var(--f);color:var(--t1);width:100%;outline:none}
.ctx-switch{display:flex;background:var(--inp);border-radius:var(--r);padding:3px;border:1.5px solid var(--bd)}
.ctx-btn{padding:5px 16px;border:none;background:none;border-radius:6px;font-size:12px;font-weight:600;color:var(--t3);cursor:pointer;font-family:var(--f)}.ctx-btn.on{background:var(--ac);color:#000}
.page{flex:1;overflow-y:auto;padding:24px}
.page-head{display:flex;align-articles:flex-start;justify-content:space-between;margin-bottom:24px;gap:16px}
.page-head h1{font-size:22px;font-weight:700}.page-head .desc{font-size:13px;color:var(--t2);margin-top:3px}
.actions{display:flex;gap:8px;flex-shrink:0}
.stats{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:14px;margin-bottom:24px}
.stat{background:var(--card);border:1.5px solid var(--bd);border-radius:var(--rl);padding:18px 20px;transition:border-color .15s}.stat:hover{border-color:var(--acb)}
.s-icon{width:36px;height:36px;border-radius:var(--r);display:flex;align-articles:center;justify-content:center;font-size:18px;margin-bottom:10px}
.s-icon.a{background:var(--acl)}.s-icon.b{background:var(--bll)}.s-icon.g{background:var(--gnl)}.s-icon.r{background:var(--rdl)}.s-icon.o{background:var(--orl)}
.s-label{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--t3)}
.s-val{font-size:26px;font-weight:700;font-family:var(--mo);margin:4px 0;letter-spacing:-1px}
.s-ch{font-size:11px;font-weight:500;color:var(--t3)}.s-ch.up{color:var(--gn)}.s-ch.dn{color:var(--rd)}
.card{background:var(--card);border:1.5px solid var(--bd);border-radius:var(--rl);overflow:hidden}.card+.card{margin-top:16px}
.ch{display:flex;align-articles:center;justify-content:space-between;padding:14px 20px;border-bottom:1px solid var(--bd)}.ch .ct{font-size:14px;font-weight:700}
.cb{padding:20px}.cb.np{padding:0}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:16px}.row21{display:grid;grid-template-columns:2fr 1fr;gap:20px}.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
.tbar{display:flex;align-articles:center;justify-content:space-between;padding:10px 16px;gap:10px;flex-wrap:wrap}
.filters{display:flex;align-articles:center;gap:8px}
.fi{padding:7px 12px;border:1.5px solid var(--bd);border-radius:var(--r);font-size:13px;font-family:var(--f);background:var(--inp);min-width:140px}.fi:focus{outline:none;border-color:var(--ac)}
.tw{overflow-x:auto}table{width:100%;border-collapse:collapse}
th{padding:9px 16px;text-align:left;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);background:var(--inp);border-bottom:1px solid var(--bd);white-space:nowrap}
td{padding:11px 16px;font-size:13px;border-bottom:1px solid var(--bd);vertical-align:middle}
tr:hover td{background:var(--hov)}tr:last-child td{border-bottom:none}tr.ck{cursor:pointer}
.b{display:inline-flex;align-articles:center;padding:3px 10px;border-radius:99px;font-size:10px;font-weight:700;letter-spacing:.3px;text-transform:uppercase}
.b-gn{background:var(--gnl);color:var(--gn);border:1px solid var(--gnb)}.b-bl{background:var(--bll);color:var(--bl);border:1px solid var(--blb)}
.b-or{background:var(--orl);color:var(--or);border:1px solid var(--orb)}.b-rd{background:var(--rdl);color:var(--rd);border:1px solid var(--rdb)}
.b-gr{background:var(--inp);color:var(--t3);border:1px solid var(--bd)}
.src{font-size:9px;padding:2px 7px;border-radius:4px;font-weight:700;letter-spacing:.4px}.src-i{background:#dbeafe;color:#1e40af}.src-e{background:#fef3c7;color:#92400e}
.dg{display:grid;grid-template-columns:140px 1fr;gap:6px 16px;font-size:13px}.dl{color:var(--t3);font-weight:500}.dv{font-weight:400}
.tl{padding-left:20px;position:relative}.tl::before{content:'';position:absolute;left:5px;top:4px;bottom:4px;width:2px;background:var(--bd)}
.tl-i{position:relative;padding:0 0 14px}.tl-i::before{content:'';position:absolute;left:-18px;top:4px;width:10px;height:10px;border-radius:50%;background:var(--ac);border:2px solid var(--card)}
.tl-i.d::before{background:var(--gn)}.tl-t{font-size:12px;font-weight:600}.tl-m{font-size:11px;color:var(--t3)}
.pick{display:flex;align-articles:center;gap:16px;padding:14px 16px;border:2px solid var(--bd);border-radius:var(--rl);margin-bottom:8px;transition:all .15s}
.pick.ok{border-color:var(--gn);background:var(--gnl)}.pick.wt{border-color:var(--orb)}
.pick-s{width:42px;height:42px;border-radius:50%;display:flex;align-articles:center;justify-content:center;font-size:18px;font-weight:700;flex-shrink:0}
.pick-s.g{background:var(--gn);color:#fff}.pick-s.w{background:var(--orl);color:var(--or);border:2px solid var(--or)}
.loc{font-family:var(--mo);font-weight:700;color:var(--bl);font-size:14px}
.prog{height:6px;background:var(--inp);border-radius:3px;overflow:hidden;margin:6px 0}.pf{height:100%;border-radius:3px;transition:width .3s}.pf.g{background:var(--gn)}.pf.b{background:var(--bl)}
.al{padding:11px 16px;border-radius:var(--r);font-size:13px;margin-bottom:14px;display:flex;align-articles:center;gap:10px;font-weight:500}
.al-i{background:var(--bll);color:var(--bl);border:1px solid var(--blb)}.al-w{background:var(--orl);color:var(--or);border:1px solid var(--orb)}.al-e{background:var(--rdl);color:var(--rd);border:1px solid var(--rdb)}.al-ok{background:var(--gnl);color:var(--gn);border:1px solid var(--gnb)}
.cutoff{display:flex;align-articles:center;gap:10px;padding:10px 16px;background:var(--acl);border:1px solid var(--acb);border-radius:var(--r);font-size:12px;font-weight:600;color:var(--ach)}
.tabs{display:flex;border-bottom:1.5px solid var(--bd);margin-bottom:20px}.tab{padding:10px 20px;font-size:13px;font-weight:500;color:var(--t3);cursor:pointer;border:none;border-bottom:2px solid transparent;font-family:var(--f);background:none}.tab:hover{color:var(--t1)}.tab.on{color:var(--ac);border-bottom-color:var(--ac);font-weight:600}
.tab-c{display:none}.tab-c.on{display:block}
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(3px);display:none;align-articles:center;justify-content:center;z-index:1000}.modal-bg.on{display:flex}
.modal{background:var(--card);border-radius:16px;max-width:600px;width:92%;max-height:85vh;overflow-y:auto;box-shadow:var(--shl);animation:mIn .2s}
@keyframes mIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.mh{display:flex;align-articles:center;justify-content:space-between;padding:18px 24px;border-bottom:1px solid var(--bd)}.mh h3{font-size:16px;font-weight:700}.mbdy{padding:24px}.mft{display:flex;justify-content:flex-end;gap:8px;padding:14px 24px;border-top:1px solid var(--bd)}
.m-x{background:none;border:none;cursor:pointer;font-size:18px;color:var(--t3);padding:4px}
.toast-w{position:fixed;top:20px;right:20px;z-index:2000;display:flex;flex-direction:column;gap:8px}
.toast{display:flex;align-articles:center;gap:10px;padding:12px 20px;border-radius:var(--r);font-size:13px;font-weight:600;box-shadow:var(--shl);animation:tIn .25s;color:#fff;min-width:260px}
.toast.ok{background:var(--gn)}.toast.er{background:var(--rd)}.toast.wn{background:var(--or)}.toast.in{background:var(--bl)}
@keyframes tIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
.confirm-bg{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:3000;display:none;align-articles:center;justify-content:center}.confirm-bg.on{display:flex}
.confirm{background:var(--card);border-radius:16px;padding:32px;max-width:400px;text-align:center;box-shadow:var(--shl)}.confirm .ci{font-size:40px;margin-bottom:14px}.confirm h3{font-size:17px;margin-bottom:6px}.confirm p{color:var(--t2);font-size:13px;margin-bottom:22px}.ca{display:flex;gap:10px;justify-content:center}
.np-panel{position:absolute;top:var(--th);right:24px;width:380px;background:var(--card);border:1.5px solid var(--bd);border-radius:var(--rl);box-shadow:var(--shl);z-index:200;max-height:420px;overflow-y:auto;display:none}.np-panel.on{display:block}
.np-head{display:flex;align-articles:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid var(--bd)}.np-head h3{font-size:14px;font-weight:700}
.np-i{display:flex;gap:10px;padding:12px 18px;border-bottom:1px solid var(--bd);cursor:pointer}.np-i:hover{background:var(--hov)}.np-i.new{background:var(--bll)}
.np-dot{width:7px;height:7px;border-radius:50%;background:var(--bl);flex-shrink:0;margin-top:5px}.np-dot.rd{background:var(--bd)}
.empty{text-align:center;padding:48px 32px;color:var(--t3)}.empty .ei{font-size:44px;margin-bottom:14px}.empty h3{font-size:16px;font-weight:600;color:var(--t1);margin-bottom:6px}.empty p{font-size:13px;max-width:320px;margin:0 auto 16px}
.mono{font-family:var(--mo)}.fw6{font-weight:600}.fw7{font-weight:700}.tr{text-align:right}.tc{text-align:center}.muted{color:var(--t3)}.sec{color:var(--t2)}.sm{font-size:12px}.xs{font-size:11px}
.mb8{margin-bottom:8px}.mb12{margin-bottom:12px}.mb16{margin-bottom:16px}.mt4{margin-top:4px}.mt8{margin-top:8px}.mt16{margin-top:16px}
.flex{display:flex}.flex-b{display:flex;justify-content:space-between;align-articles:center}.gap4{gap:4px}.gap8{gap:8px}.gap12{gap:12px}
.grid-f{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.divider{border:none;border-top:1px solid var(--bd);margin:16px 0}
.scan{padding:14px;border:3px solid var(--ac);border-radius:var(--rl);font-size:18px;font-family:var(--mo);text-align:center;width:100%;background:var(--acl)}.scan:focus{outline:none;box-shadow:0 0 0 4px var(--acl)}
.inline-f{display:flex;gap:8px;align-articles:flex-end}.inline-f .fg{margin-bottom:0;flex:1}
.link{color:var(--bl);cursor:pointer;font-weight:500}.link:hover{text-decoration:underline}
.tfoot{display:flex;align-articles:center;justify-content:space-between;padding:10px 16px;font-size:12px;color:var(--t3);border-top:1px solid var(--bd)}
@media(max-width:1024px){.sidebar{width:64px;overflow:hidden}.sb-head .sb-title,.sb-head .sb-ctx,.sb-nav .sb-section,.sb-item span:not(.ico),.sb-item .badge,.sb-foot .sb-uname,.sb-foot .sb-urole{display:none}.sb-head{padding:16px 15px}.sb-item{padding:10px 16px;justify-content:center}.sb-foot{justify-content:center}.search-box{width:180px}}
@media(max-width:768px){.stats{grid-template-columns:1fr 1fr}.row21,.row2,.row3{grid-template-columns:1fr}.page-head{flex-direction:column}.actions{width:100%}}
</style>
</head>
<body>
<div id="login-screen" class="screen active">
<div class="login-wrap">
  <div class="login-left"><div class="login-brand"><div class="logo-row"><div class="logo-mark">M</div><div class="logo-text">MECADEPOT</div></div><h1>Pi√®ces Auto B2B<br><span>ERP Distribution</span></h1><p>Catalogue, agr√©gation multi-fournisseurs, op√©rations entrep√¥t, facturation et portail B2B ‚Äî tout en un seul syst√®me.</p><div class="login-pills"><div class="login-pill">üì¶ 5 APIs Fournisseurs</div><div class="login-pill">üöó TecCom</div><div class="login-pill">üèóÔ∏è Zones Entrep√¥t</div><div class="login-pill">üí≥ POS + Stripe</div><div class="login-pill">üîí 10 R√¥les</div></div></div></div>
  <div class="login-right"><div class="login-form"><h2>Connexion</h2><p class="sub">S√©lectionnez un r√¥le pour explorer le prototype</p>
    <div class="fg"><label>E-mail</label><input type="email" value="nabilbouzid@mecadepot.fr"></div>
    <div class="fg"><label>Mot de passe</label><input type="password" value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
    <div class="fg"><label>R√¥le <em>(prototype)</em></label><select id="role-sel"><optgroup label="‚îÄ‚îÄ‚îÄ Interne ‚îÄ‚îÄ‚îÄ"><option value="OWNER" selected>OWNER ‚Äî Propri√©taire</option><option value="MANAGER">MANAGER ‚Äî Responsable</option><option value="COUNTER_AGENT">COUNTER_AGENT ‚Äî Vendeur / Agent Comptoir</option><option value="WAREHOUSE_KEEPER">WAREHOUSE_KEEPER ‚Äî Magasinier</option><option value="PURCHASER">PURCHASER ‚Äî Acheteur</option><option value="ACCOUNTING">ACCOUNTING ‚Äî Comptable</option><option value="ADMIN">ADMIN ‚Äî Admin Syst√®me</option></optgroup><optgroup label="‚îÄ‚îÄ‚îÄ Portail B2B ‚îÄ‚îÄ‚îÄ"><option value="B2B_OWNER">B2B_OWNER ‚Äî G√©rant Soci√©t√©</option><option value="B2B_BUYER">B2B_BUYER ‚Äî Acheteur</option><option value="B2B_VIEWER">B2B_VIEWER ‚Äî Consultation</option></optgroup></select></div>
    <button class="btn btn-ac btn-full" onclick="doLogin()" style="padding:12px;font-size:14px">Connexion ‚Üí</button>
    <div style="text-align:center;margin-top:32px;font-size:11px;color:var(--t3)">MECADEPOT ERP v2.2 ¬∑ Prototype ¬∑ 40 pages ¬∑ 10 r√¥les</div>
  </div></div>
</div></div>
<div id="app-screen" class="screen"><div id="app">
  <nav class="sidebar"><div class="sb-head"><div class="sb-mark">M</div><div><div class="sb-title">MECADEPOT</div><div class="sb-ctx" id="sb-ctx">INTERNAL</div></div></div><div class="sb-nav" id="sb-nav"></div><div class="sb-foot"><div class="sb-avatar" id="sb-av">MP</div><div><div class="sb-uname" id="sb-un">Max</div><div class="sb-urole" id="sb-ur">OWNER</div></div><div class="sb-logout" onclick="doLogout()" title="D√©connexion"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M18 6L6 18"/><path d="M6 6l12 12"/></svg></div></div></nav>
  <div class="main"><header class="topbar"><div class="crumbs" id="crumbs"><span>Tableau de bord</span></div><div class="tb-right"><div class="search-box"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg><input placeholder="Rechercher‚Ä¶ (Ctrl+K)" id="gsearch" oninput="globalSearch(this.value)"></div><div class="btn-icon" onclick="toggleNP()" style="position:relative;background:none;border:none;padding:6px;cursor:pointer;color:var(--t3)"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg><div style="position:absolute;top:2px;right:2px;width:8px;height:8px;background:var(--rd);border-radius:50%;border:2px solid var(--card)"></div></div><div class="ctx-switch" id="ctx-sw" style="display:none"><button class="ctx-btn on" onclick="swCtx('internal',this)">Interne</button><button class="ctx-btn" onclick="swCtx('pos',this)">POS</button></div></div></header>
    <div class="np-panel" id="npanel"><div class="np-head"><h3>Notifications</h3><button class="btn-link" onclick="toggleNP()">Fermer</button></div>
      <div class="np-i new" onclick="toggleNP();go('discounts')"><div class="np-dot"></div><div><div class="fw6 sm">Demande de remise en attente</div><div class="xs sec">Sarah demande 12% sur ORD-2026-00187</div><div class="xs muted" style="margin-top:3px">Il y a 5 min</div></div></div>
      <div class="np-i new" onclick="toggleNP();go('stock')"><div class="np-dot"></div><div><div class="fw6 sm">Stock bas ‚Äî URGENT</div><div class="xs sec">Bosch 0986494524 : 2 / seuil 5</div><div class="xs muted" style="margin-top:3px">Il y a 12 min</div></div></div>
      <div class="np-i" onclick="toggleNP();go('warehouse')"><div class="np-dot rd"></div><div><div class="fw6 sm">Livraison pr√©vue</div><div class="xs sec">Ridex ‚Äî 6 BC ~08:00</div><div class="xs muted" style="margin-top:3px">Il y a 1h</div></div></div>
    </div>
    <div class="page" id="page"></div>
  </div>
</div></div>
<div class="modal-bg" id="modal-bg" onclick="closeModal()"><div class="modal" id="modal" onclick="event.stopPropagation()"></div></div>
<div class="toast-w" id="toasts"></div>
<div class="confirm-bg" id="cfm-bg"><div class="confirm" id="cfm-box"></div></div>
<script>
let R='OWNER',P='dashboard',CTX='internal',CART=[],POS_OPEN=true;
const U={ADMIN:{n:'Nabil Bouzid',i:'NB'},OWNER:{n:'Nabil Bouzid',i:'NB'},MANAGER:{n:'Marie Dupuis',i:'MD'},COUNTER_AGENT:{n:'Sarah Vendeuse',i:'SV'},WAREHOUSE_KEEPER:{n:'Karim Entrepot',i:'KE'},PURCHASER:{n:'Nabil Bouzid',i:'NB'},ACCOUNTING:{n:'Claire Compta',i:'CC'},B2B_OWNER:{n:'Pierre Martin',i:'PM',co:'Garage Martin'},B2B_BUYER:{n:'Jean Acheteur',i:'JA',co:'Garage Martin'},B2B_VIEWER:{n:'Lucie Vue',i:'LV',co:'Garage Martin'}};
const PR=[
{id:'P01',sk:'BRK-001',nm:'Plaquettes frein Brembo P06075',br:'Brembo',ct:'Freinage',ean:'8020584058084',stk:15,rsv:3,thr:5,buy:22.5,sell:45,loc:'A-02-03-B',sup:'Ridex'},
{id:'P02',sk:'FLT-042',nm:'Filtre huile Mann HU716/2x',br:'Mann-Filter',ct:'Filtration',ean:'4011558296100',stk:4,rsv:0,thr:8,buy:5.8,sell:12.5,loc:'B-01-05-A',sup:'AutoPartner'},
{id:'P03',sk:'DSK-019',nm:'Disque frein Brembo 09.A820.11',br:'Brembo',ct:'Freinage',ean:'8020584014288',stk:0,rsv:0,thr:3,buy:32,sell:68,loc:'‚Äî',sup:'PSH'},
{id:'P04',sk:'SPK-010',nm:'Bougie Bosch 0242236571',br:'Bosch',ct:'Allumage',ean:'3165143523517',stk:48,rsv:4,thr:10,buy:3.5,sell:8.9,loc:'C-03-01-C',sup:'Ridex'},
{id:'P05',sk:'BLT-003',nm:'Courroie Gates K015603XS',br:'Gates',ct:'Distribution',ean:'5412571152440',stk:6,rsv:1,thr:4,buy:85,sell:165,loc:'D-01-02-A',sup:'AutoPartner'},
{id:'P06',sk:'CLT-007',nm:'Liquide Glaceol RX Type D',br:'Total',ct:'Lubrifiants',ean:'3425901147987',stk:22,rsv:0,thr:8,buy:12,sell:24.5,loc:'E-02-01-D',sup:'AJS'},
{id:'P07',sk:'AMR-015',nm:'Amortisseur Sachs 314700',br:'Sachs',ct:'Suspension',ean:'4013872862184',stk:8,rsv:2,thr:4,buy:48,sell:95,loc:'D-03-04-B',sup:'Ridex'},
{id:'P08',sk:'WPR-022',nm:'Balai Bosch A933S',br:'Bosch',ct:'Essuyage',ean:'3397118933',stk:35,rsv:0,thr:12,buy:14,sell:29.9,loc:'F-01-02-A',sup:'Ridex'},
{id:'P09',sk:'BAT-005',nm:'Batterie Varta Blue E11 74Ah',br:'Varta',ct:'√âlectricit√©',ean:'4016987119563',stk:3,rsv:1,thr:3,buy:65,sell:129,loc:'A-04-01-A',sup:'PSH'},
{id:'P10',sk:'BRK-045',nm:'Kit plaquettes Bosch 0986494524',br:'Bosch',ct:'Freinage',ean:'4047024737723',stk:2,rsv:0,thr:5,buy:18.5,sell:38,loc:'A-02-04-A',sup:'Ridex'},
{id:'P11',sk:'OIL-008',nm:'Huile Total Quartz 5W-40 5L',br:'Total',ct:'Lubrifiants',ean:'3425900000329',stk:18,rsv:2,thr:6,buy:28,sell:52,loc:'E-01-01-A',sup:'AJS'},
{id:'P12',sk:'ENG-100',nm:'Support moteur Febi 23918',br:'Febi',ct:'Moteur',ean:'4027816239185',stk:5,rsv:0,thr:2,buy:28,sell:58,loc:'D-02-03-C',sup:'AutoPartner'},
{id:'P13',sk:'EMB-012',nm:'Kit embrayage Valeo 826729',br:'Valeo',ct:'Embrayage',ean:'3276428267295',stk:0,rsv:0,thr:1,buy:108,sell:210,loc:'‚Äî',sup:'AJS',ext:1,ld:'J+1'},
{id:'P14',sk:'PMP-018',nm:'Pompe √† eau SKF VKPC 85101',br:'SKF',ct:'Refroid.',ean:'7316572601013',stk:0,rsv:0,thr:2,buy:38,sell:75,loc:'‚Äî',sup:'InterCar',ext:1,ld:'J+2'},
{id:'P15',sk:'TRB-003',nm:'Turbo Garrett 760774-5003S',br:'Garrett',ct:'Turbo',ean:'8012345678901',stk:0,rsv:0,thr:1,buy:340,sell:645,loc:'‚Äî',sup:'InterCar',ext:1,ld:'J+2'},
{id:'P16',sk:'CMP-009',nm:'Compresseur clim Denso DCP17068',br:'Denso',ct:'Climatisation',ean:'4046283399680',stk:0,rsv:0,thr:1,buy:185,sell:350,loc:'‚Äî',sup:'AJS',ext:1,ld:'J+2'},
{id:'P17',sk:'DSK-025',nm:'Disque frein ATE 24.0128-0292.1',br:'ATE',ct:'Freinage',ean:'4006633326414',stk:0,rsv:0,thr:2,buy:35,sell:72,loc:'‚Äî',sup:'Ridex',ext:1,ld:'J+1'},
{id:'P18',sk:'AMR-022',nm:'Amortisseur Monroe G8095',br:'Monroe',ct:'Suspension',ean:'5412096349355',stk:0,rsv:0,thr:2,buy:52,sell:105,loc:'‚Äî',sup:'PSH',ext:1,ld:'J+1'}];
const OD=[
{id:'O1',n:'ORD-2026-00185',st:'DELIVERED',tp:'B2B',cu:'Garage Martin',dt:'2026-02-12',ttc:5640,ht:4700,pay:'PAID',dm:'COMPLETE',ln:4,by:'Sarah',inv:'INV-2026-00102'},
{id:'O2',n:'ORD-2026-00186',st:'READY',tp:'B2B',cu:'Garage Dupont',dt:'2026-02-12',ttc:2730,ht:2275,pay:'PAID',dm:'PARTIAL',ln:2,by:'Sarah'},
{id:'O3',n:'ORD-2026-00187',st:'CONFIRMED',tp:'B2B',cu:'Garage Martin',dt:'2026-02-13',ttc:18720,ht:15600,pay:'PENDING',dm:'PARTIAL',ln:5,by:'Sarah',disc:{st:'PENDING_APPROVAL',pct:12,rsn:'Client fid√®le, volume',who:'Sarah'}},
{id:'O4',n:'ORD-2026-00188',st:'PREPARING',tp:'COUNTER',cu:'Walk-in',dt:'2026-02-13',ttc:985,ht:820.83,pay:'PAID',ln:2,by:'Sarah'},
{id:'O5',n:'ORD-2026-00189',st:'CREATED',tp:'B2B',cu:'Auto Mercier',dt:'2026-02-13',ttc:12480,ht:10400,pay:'PENDING',dm:'COMPLETE',ln:6,by:'Sarah'},
{id:'O6',n:'ORD-2026-00190',st:'PARTIALLY_DELIVERED',tp:'B2B',cu:'Garage Leroy',dt:'2026-02-12',ttc:3960,ht:3300,pay:'PAID',dm:'PARTIAL',ln:3,by:'Sarah'},
{id:'O7',n:'ORD-2026-00191',st:'CANCELLED',tp:'B2B',cu:'Carrosserie Bernard',dt:'2026-02-11',ttc:0,ht:0,pay:'REFUNDED',ln:1,by:'Sarah'}];
const QU=[{id:'Q1',n:'QUO-2026-00014',st:'SENT',cu:'Garage Martin',dt:'2026-02-10',exp:'2026-03-12',ttc:8580,ht:7150,ln:3},{id:'Q2',n:'QUO-2026-00015',st:'DRAFT',cu:'Auto Mercier',dt:'2026-02-13',exp:'2026-03-15',ttc:21450,ht:17875,ln:5},{id:'Q3',n:'QUO-2026-00013',st:'CONVERTED',cu:'Garage Dupont',dt:'2026-02-08',exp:'2026-03-10',ttc:2730,ht:2275,ln:2},{id:'Q4',n:'QUO-2026-00012',st:'EXPIRED',cu:'Garage Leroy',dt:'2026-01-05',exp:'2026-02-04',ttc:5950,ht:4958,ln:4}];
const IV=[{id:'I1',n:'INV-2026-00098',st:'PAID',cu:'Garage Martin',dt:'2026-02-10',ht:3250,vat:650,ttc:3900,ord:'ORD-00181'},{id:'I2',n:'INV-2026-00099',st:'SENT',cu:'Auto Mercier',dt:'2026-02-11',ht:7980,vat:1596,ttc:9576,ord:'ORD-00183'},{id:'I3',n:'INV-2026-00100',st:'ISSUED',cu:'Garage Dupont',dt:'2026-02-11',ht:5600,vat:1120,ttc:6720,ord:'ORD-00184'},{id:'I4',n:'INV-2026-00101',st:'PAID',cu:'Garage Leroy',dt:'2026-02-12',ht:1680,vat:336,ttc:2016,ord:'ORD-00185'},{id:'I5',n:'INV-2026-00102',st:'PAID',cu:'Garage Martin',dt:'2026-02-12',ht:4700,vat:940,ttc:5640,ord:'ORD-00185'}];
const SP=[{id:'S1',cd:'RIDEX',nm:'Ridex',api:1,tp:'REST',pri:1,rel:98,cut:'17:00',ld:1,ct:'Laurent D.',em:'cmd@ridex.fr',ph:'+33 1 42 00 00 00'},{id:'S2',cd:'AUTOPART',nm:'AutoPartner',api:1,tp:'REST',pri:2,rel:95,cut:'17:30',ld:1,ct:'Marc L.',em:'b2b@autopartner.fr',ph:'+33 1 43 00 00 00'},{id:'S3',cd:'PSH',nm:'PSH',api:1,tp:'SOAP',pri:3,rel:92,cut:'16:30',ld:1,ct:'Anne M.',em:'orders@psh.fr',ph:'+33 1 44 00 00 00'},{id:'S4',cd:'AJS',nm:'AJS',api:0,tp:'‚Äî',pri:4,rel:88,cut:'16:00',ld:2,ct:'Philippe G.',em:'ventes@ajs.fr',ph:'+33 1 45 00 00 00'},{id:'S5',cd:'INTERCAR',nm:'InterCar',api:0,tp:'FILE',pri:5,rel:85,cut:'15:00',ld:2,ct:'Hans W.',em:'orders@intercar.eu',ph:'+49 30 00 00 00'}];
const TK=[{n:'TKT-0001',t:'08:15',c:'Garage Martin',it:2,ttc:1560,m:'CARD'},{n:'TKT-0002',t:'08:42',c:'Walk-in',it:1,ttc:520,m:'CASH'},{n:'TKT-0003',t:'09:10',c:'Garage Dupont',it:3,ttc:2730,m:'CARD'},{n:'TKT-0004',t:'09:55',c:'Walk-in',it:1,ttc:910,m:'CASH'},{n:'TKT-0005',t:'10:30',c:'Garage Leroy',it:2,ttc:1990,m:'CARD'},{n:'TKT-0006',t:'11:15',c:'Walk-in',it:4,ttc:1530,m:'MIXED'},{n:'TKT-0007',t:'11:48',c:'Auto Mercier',it:2,ttc:2830,m:'CARD'}];
const CU=[{id:'C1',cd:'MARTIN',nm:'Garage Martin',tp:'B2B',st:'ACTIVE',grid:'Gold (-10%)',disc:10,city:'St-Antoine 95',siret:'12345678901234',rep:'Sarah',usr:'3/5',em:'pierre@garagemartin.fr',ph:'+33 1 34 56 78 90',addr:'12 rue de la Gare, 95210 St-Antoine'},{id:'C2',cd:'DUPONT',nm:'Garage Dupont',tp:'B2B',st:'ACTIVE',grid:'Silver (-7%)',disc:7,city:'Cergy 95',siret:'98765432109876',rep:'Sarah',usr:'1/3',em:'contact@dupont.fr',ph:'+33 1 34 00 00 00',addr:'5 av. du Parc, 95000 Cergy'},{id:'C3',cd:'LEROY',nm:'Garage Leroy',tp:'B2B',st:'ACTIVE',grid:'Standard (-5%)',disc:5,city:'Pontoise 95',siret:'55566677788899',rep:'Sarah',usr:'2/5',em:'leroy@auto.fr',ph:'+33 1 30 00 00 00',addr:'18 bd Victor Hugo, 95300 Pontoise'},{id:'C4',cd:'MERCIER',nm:'Auto Mercier',tp:'B2B',st:'ACTIVE',grid:'Gold (-10%)',disc:10,city:'Argenteuil 95',siret:'11122233344455',rep:'Marie',usr:'4/5',em:'contact@mercier.fr',ph:'+33 1 39 00 00 00',addr:'22 rue Jean Jaur√®s, 95100 Argenteuil'},{id:'C5',cd:'BERNARD',nm:'Carrosserie Bernard',tp:'B2B',st:'SUSPENDED',grid:'Standard',disc:5,city:'Enghien 95',siret:'22233344455566',rep:'Marie',usr:'1/3',em:'bernard@carrosserie.fr',ph:'+33 1 34 12 00 00',addr:'8 rue du Lac, 95880 Enghien'},{id:'C6',cd:'WALKIN',nm:'Client Comptoir',tp:'WALK_IN',st:'ACTIVE',grid:'Public (0%)',disc:0,city:'‚Äî',siret:'‚Äî',rep:'‚Äî',usr:'‚Äî',em:'‚Äî',ph:'‚Äî',addr:'‚Äî'}];
const PL=[{id:'L1',n:'PO-2026-00042',su:'Ridex',st:'RECEIVED',ht:1480,dt:'2026-02-11',exp:'2026-02-12',ref:'RX-260211-7821',ln:3},{id:'L2',n:'PO-2026-00043',su:'Ridex',st:'CONFIRMED',ht:295,dt:'2026-02-13',exp:'2026-02-14',ref:'RX-260213-8042',ln:1},{id:'L3',n:'PO-2026-00044',su:'AutoPartner',st:'CONFIRMED',ht:1675,dt:'2026-02-13',exp:'2026-02-14',ref:'AP-260213-5501',ln:2},{id:'L4',n:'PO-2026-00045',su:'PSH',st:'PENDING_APPROVAL',ht:27500,dt:'2026-02-13',exp:'2026-02-14',ref:'‚Äî',ln:8},{id:'L5',n:'PO-2026-00046',su:'Ridex',st:'SHIPPED',ht:4080,dt:'2026-02-12',exp:'2026-02-13',ref:'RX-260212-8001',ln:4}];
const AL=[{p:'Kit plaquettes Bosch 0986494524',sk:'BRK-045',stk:2,thr:5,sev:'URGENT',su:'Ridex',pr:18.5},{p:'Filtre huile Mann HU716/2x',sk:'FLT-042',stk:4,thr:8,sev:'NORMAL',su:'AutoPartner',pr:5.8},{p:'Disque frein Brembo 09.A820.11',sk:'DSK-019',stk:0,thr:3,sev:'OUT_OF_STOCK',su:'PSH',pr:32},{p:'Batterie Varta Blue E11',sk:'BAT-005',stk:3,thr:3,sev:'URGENT',su:'PSH',pr:65}];

const NAV={
OWNER:[['Principal',[['dashboard','üìä','Tableau de bord']]],['Commerce',[['catalog','üì¶','Catalogue'],['orders','üõí','Commandes','2'],['quotes','üìã','Devis'],['customers','üë•','Clients'],['discounts','üè∑Ô∏è','Remises','1','w']]],['Approvisionnement',[['sup-compare','‚öñÔ∏è','Comparateur Fournisseurs'],['suppliers','üè≠','Fournisseurs'],['po','üì¨','Bons de Commande'],['stock-alerts','üö®','Alertes Stock','4','w'],['stock','üìä','Stock'],['warehouse','üèóÔ∏è','Entrep√¥t']]],['Finance',[['invoices','üìÑ','Factures'],['credit-notes','‚Ü©Ô∏è','Avoirs'],['returns','üì¶','Retours'],['pos-page','üí≥','POS']]],['Administration',[['users','üë§','Utilisateurs'],['discount-matrix','üí∞','Matrice Remises'],['pricing','üí∞','Grilles Tarifaires'],['settings','‚öôÔ∏è','Param√®tres']]]],
COUNTER_AGENT:[['Principal',[['dashboard','üìä','Tableau de bord']]],['Ventes',[['catalog','üì¶','Catalogue'],['orders','üõí','Commandes'],['quotes','üìã','Devis'],['customers','üë•','Clients']]],['Caisse',[['pos-page','üí≥','Caisse POS']]]],
WAREHOUSE_KEEPER:[['Principal',[['wh-dash','üìä','Tableau du matin']]],['Op√©rations',[['warehouse','üèóÔ∏è','R√©ception'],['picking','üìã','Pr√©paration'],['stock','üìä','Stock'],['inventory','üì±','Inventaire Zone']]]],
PURCHASER:[['Principal',[['dashboard','üìä','Tableau de bord']]],['Achats',[['sup-compare','‚öñÔ∏è','Comparateur Fournisseurs'],['suppliers','üè≠','Fournisseurs'],['po','üì¨','Bons de Commande'],['stock-alerts','üö®','Alertes Stock','4','w'],['stock','üìä','Stock'],['ocr','üßæ','Import OCR'],['sup-ret','‚Ü©Ô∏è','Retours Fournisseurs']]],['Catalogue',[['catalog','üì¶','Produits']]]],
ACCOUNTING:[['Principal',[['dashboard','üìä','Tableau de bord']]],['Finance',[['invoices','üìÑ','Factures'],['credit-notes','‚Ü©Ô∏è','Avoirs'],['returns','üì¶','Retours'],['pos-page','üí≥','Cl√¥tures POS']]]],
B2B_OWNER:[['Portail',[['b2b-dash','üìä','Tableau de bord'],['b2b-cat','üì¶','Catalogue'],['b2b-cart','üõí','Panier'],['b2b-ord','üõí','Mes Commandes'],['b2b-inv','üìÑ','Mes Factures'],['b2b-pro','üë§','Soci√©t√©']]]],
B2B_BUYER:[['Portail',[['b2b-cat','üì¶','Catalogue'],['b2b-cart','üõí','Panier'],['b2b-ord','üõí','Mes Commandes'],['b2b-inv','üìÑ','Factures']]]],
B2B_VIEWER:[['Portail',[['b2b-cat','üì¶','Catalogue (lecture)'],['b2b-ord','üõí','Commandes (lecture)'],['b2b-inv','üìÑ','Factures (lecture)']]]]
};NAV.ADMIN=NAV.OWNER;NAV.MANAGER=NAV.OWNER;

function E(v){return Number(v).toFixed(2)+' ‚Ç¨'}
function bd(s){const m={DELIVERED:'gn',PAID:'gn',ACTIVE:'gn',RECEIVED:'gn',VALIDATED:'gn',APPROVED:'gn',CONVERTED:'gn',READY:'bl',CONFIRMED:'bl',SENT:'bl',ISSUED:'bl',OPEN:'bl',SHIPPED:'bl',PREPARING:'or',PENDING:'or',PENDING_APPROVAL:'or',DRAFT:'or',IMPORTED:'or',PARTIALLY_DELIVERED:'or',CREATED:'or',NORMAL:'bl',CANCELLED:'rd',REJECTED:'rd',EXPIRED:'rd',SUSPENDED:'rd',OUT_OF_STOCK:'rd',URGENT:'or',CLOSED:'gr',RESOLVED:'gn',REQUESTED:'or',B2B_OWNER:'bl',B2B_BUYER:'or',B2B_VIEWER:'gr',MANUAL:'gr'};const t={DELIVERED:'LIVR√â',PAID:'PAY√â',ACTIVE:'ACTIF',RECEIVED:'RE√áU',VALIDATED:'VALID√â',APPROVED:'APPROUV√â',CONVERTED:'CONVERTI',READY:'PR√äT',CONFIRMED:'CONFIRM√â',SENT:'ENVOY√â',ISSUED:'√âMIS',SHIPPED:'EXP√âDI√â',PREPARING:'EN PR√âPA.',PENDING:'EN ATTENTE',PENDING_APPROVAL:'EN ATTENTE APPRO.',DRAFT:'BROUILLON',IMPORTED:'IMPORT√â',PARTIALLY_DELIVERED:'LIVR√â PARTIEL',CREATED:'CR√â√â',CANCELLED:'ANNUL√â',REJECTED:'REJET√â',EXPIRED:'EXPIR√â',SUSPENDED:'SUSPENDU',OUT_OF_STOCK:'RUPTURE',REQUESTED:'DEMAND√â',RESOLVED:'R√âSOLU',CLOSED:'FERM√â',REFUNDED:'REMBOURS√â',MANUAL:'MANUEL'};return `<span class="b b-${m[s]||'gr'}">${t[s]||(s||'').replace(/_/g,' ')}</span>`}
function toast(m,t){const c=document.getElementById('toasts'),d=document.createElement('div');d.className='toast '+(t||'in');d.textContent=m;c.appendChild(d);setTimeout(()=>d.remove(),3500)}
function toggleNP(){document.getElementById('npanel').classList.toggle('on')}
function swCtx(c,el){CTX=c;document.querySelectorAll('.ctx-btn').forEach(b=>b.classList.remove('on'));el.classList.add('on');document.getElementById('sb-ctx').textContent=c.toUpperCase();go(c==='pos'?'pos-page':'dashboard')}
function openModal(h){document.getElementById('modal').innerHTML=h;document.getElementById('modal-bg').classList.add('on')}
function closeModal(){document.getElementById('modal-bg').classList.remove('on')}
function showCfm(t,m,fn){document.getElementById('cfm-box').innerHTML=`<div class="ci">‚ö†Ô∏è</div><h3>${t}</h3><p>${m}</p><div class="ca"><button class="btn btn-gh" onclick="document.getElementById('cfm-bg').classList.remove('on')">Annuler</button><button class="btn btn-rd" onclick="document.getElementById('cfm-bg').classList.remove('on');(${fn.toString()})()">Confirmer</button></div>`;document.getElementById('cfm-bg').classList.add('on')}
function cr(){document.getElementById('crumbs').innerHTML=[...arguments].map((x,i,a)=>i<a.length-1?`<span class="muted">${x}</span><span style="opacity:.4;margin:0 2px">‚Ä∫</span>`:`<span>${x}</span>`).join('')}
function globalSearch(v){if(!v){return};const t=v.toLowerCase();const p=PR.find(x=>x.nm.toLowerCase().includes(t)||x.sk.toLowerCase().includes(t));if(p){go('prod-d',p.id);document.getElementById('gsearch').value='';return}const c=CU.find(x=>x.nm.toLowerCase().includes(t));if(c){go('cust-d',c.id);document.getElementById('gsearch').value='';return}const o=OD.find(x=>x.n.toLowerCase().includes(t));if(o){go('order-d',o.id);document.getElementById('gsearch').value='';return}}
function doLogin(){R=document.getElementById('role-sel').value;CTX=R.startsWith('B2B')?'b2b':'internal';const u=U[R];document.getElementById('sb-un').textContent=u.n;document.getElementById('sb-ur').textContent=R;document.getElementById('sb-av').textContent=u.i;document.getElementById('sb-ctx').textContent=CTX.toUpperCase();document.getElementById('ctx-sw').style.display=R==='COUNTER_AGENT'?'flex':'none';buildNav();document.getElementById('login-screen').classList.remove('active');document.getElementById('app-screen').classList.add('active');CART=[];POS_OPEN=true;go(R==='WAREHOUSE_KEEPER'?'wh-dash':R==='B2B_OWNER'?'b2b-dash':R.startsWith('B2B')?'b2b-cat':'dashboard');toast('Connect√© en tant que '+u.n,'ok')}
function doLogout(){document.getElementById('app-screen').classList.remove('active');document.getElementById('login-screen').classList.add('active');toast('D√©connect√©','in')}
function buildNav(){const nav=NAV[R]||NAV.OWNER;document.getElementById('sb-nav').innerHTML=nav.map(([sec,articles])=>`<div class="sb-section">${sec}</div>${articles.map(([id,ico,lb,bg,bt])=>`<div class="sb-item ${id===P?'active':''}" onclick="go('${id}')" data-p="${id}"><span class="ico">${ico}</span><span>${lb}</span>${bg?`<span class="badge${bt==='w'?' w':''}">${bg}</span>`:''}</div>`).join('')}`).join('')}
function go(pg,pm){P=pg;document.querySelectorAll('.sb-item').forEach(n=>n.classList.toggle('active',n.dataset.p===pg));const el=document.getElementById('page');const fn=G[pg];el.innerHTML=fn?fn(pm):`<div class="empty"><div class="ei">üöß</div><h3>${pg}</h3><p>Module √† venir</p></div>`;el.scrollTop=0}
function filt(tableId,inputEl){const v=inputEl.value.toLowerCase();document.querySelectorAll('#'+tableId+' tbody tr').forEach(r=>{r.style.display=r.textContent.toLowerCase().includes(v)?'':'none'})}
document.addEventListener('keydown',e=>{if((e.ctrlKey||e.metaKey)&&e.key==='k'){e.preventDefault();document.getElementById('gsearch')?.focus()}if(e.key==='Escape')closeModal()});
const G={};
G.dashboard=function(){cr('Tableau de bord');
const isO=['OWNER','ADMIN','MANAGER'].includes(R),isC=R==='COUNTER_AGENT',isP=R==='PURCHASER',isA=R==='ACCOUNTING';let st='';
if(isO)st='<div class="stats"><div class="stat"><div class="s-icon a">üí∞</div><div class="s-label">CA Aujourd&#39;hui</div><div class="s-val">61 240 ‚Ç¨</div><div class="s-ch up">‚Üë 12%</div></div><div class="stat"><div class="s-icon g">üìà</div><div class="s-label">Marge</div><div class="s-val">32,4%</div><div class="s-ch up">‚Üë 1,2pts</div></div><div class="stat"><div class="s-icon b">üõí</div><div class="s-label">Commandes du jour</div><div class="s-val">148</div><div class="s-ch up">‚Üë 18</div></div><div class="stat"><div class="s-icon r">üì¶</div><div class="s-label">Alertes Stock</div><div class="s-val">4</div><div class="s-ch dn">1 OUT</div></div><div class="stat"><div class="s-icon o">üè∑Ô∏è</div><div class="s-label">Remises en attente</div><div class="s-val">1</div></div></div>';
else if(isC)st='<div class="stats"><div class="stat"><div class="s-icon a">üí≥</div><div class="s-label">Ventes du jour</div><div class="s-val">21 850 ‚Ç¨</div><div class="s-ch">72 tickets</div></div><div class="stat"><div class="s-icon g">üìà</div><div class="s-label">Marge</div><div class="s-val">29,8%</div><div class="s-ch up">‚Üë 0,5pts</div></div><div class="stat"><div class="s-icon g">üü¢</div><div class="s-label">Caisse</div><div class="s-val">'+(POS_OPEN?'OUVERTE':'FERM√âE')+'</div></div><div class="stat"><div class="s-icon o">üè∑Ô∏è</div><div class="s-label">Demandes remise</div><div class="s-val">1</div></div><div class="stat"><div class="s-icon b">üìã</div><div class="s-label">Devis</div><div class="s-val">2</div></div></div>';
else if(isP)st='<div class="stats"><div class="stat"><div class="s-icon r">üö®</div><div class="s-label">Alertes Stock</div><div class="s-val">4</div><div class="s-ch dn">1 OUT</div></div><div class="stat"><div class="s-icon o">üì¨</div><div class="s-label">BC Actifs</div><div class="s-val">3</div></div><div class="stat"><div class="s-icon b">üöö</div><div class="s-label">Livraisons du jour</div><div class="s-val">2</div></div><div class="stat"><div class="s-icon a">üßæ</div><div class="s-label">OCR</div><div class="s-val">1</div><div class="s-ch dn">Variance</div></div></div>';
else if(isA)st='<div class="stats"><div class="stat"><div class="s-icon b">üìÑ</div><div class="s-label">Factures (mois)</div><div class="s-val">380</div></div><div class="stat"><div class="s-icon o">üì®</div><div class="s-label">Non envoy√©es</div><div class="s-val">2</div></div><div class="stat"><div class="s-icon g">‚Ü©Ô∏è</div><div class="s-label">Avoirs</div><div class="s-val">2</div></div><div class="stat"><div class="s-icon a">üí≥</div><div class="s-label">Cl√¥tures POS</div><div class="s-val">42</div></div></div>';
const da=isO?'<div class="al al-w mb16">‚ö†Ô∏è <strong>1 remise en attente :</strong> Sarah demande 12% sur ORD-2026-00187 <button class="btn btn-sm btn-ac" style="margin-left:auto" onclick="go(\'discounts\')">Examiner</button></div>':'';
const or2=OD.slice(0,5).map(o=>`<tr class="ck" onclick="go('order-d','${o.id}')"><td class="mono fw6">${o.n}</td><td>${o.cu}</td><td>${bd(o.st)}</td><td class="mono tr">${E(o.ttc)}</td><td class="muted">${o.dt}</td></tr>`).join('');
const al2=AL.map(a=>`<div class="flex-b" style="padding:8px 0;border-bottom:1px solid var(--bd)"><div><div class="fw6 sm">${a.p}</div><div class="xs muted">${a.sk} ¬∑ ${E(a.pr)}</div></div><div class="flex gap8">${bd(a.sev)}<span class="mono xs fw6">${a.stk}/${a.thr}</span></div></div>`).join('');
return `<div class="page-head"><div><h1>Tableau de bord</h1><p class="desc">Bienvenue, ${U[R].n} ¬∑ 13 F√©v. 2026</p></div><div class="actions">${isC?'<button class="btn btn-ac" onclick="go(\'order-new\')">+ Nouvelle Commande</button>':''}</div></div>${st}${da}<div class="row21"><div class="card"><div class="ch"><span class="ct">Commandes r√©centes</span><button class="btn-link" onclick="go('orders')">Voir tout ‚Üí</button></div><div class="cb np"><div class="tw"><table><thead><tr><th>N¬∞ Commande</th><th>Client</th><th>Statut</th><th class="tr">TTC</th><th>Date</th></tr></thead><tbody>${or2}</tbody></table></div></div></div><div class="card"><div class="ch"><span class="ct">Alertes Stock</span><button class="btn-link" onclick="go('stock')">Voir tout ‚Üí</button></div><div class="cb">${al2}</div></div></div>`};

G['wh-dash']=function(){cr('Entrep√¥t','Matin');
return `<div class="page-head"><div><h1>üèóÔ∏è Entrep√¥t ‚Äî Tableau du Matin</h1><p class="desc">13 F√©v. 2026</p></div></div><div class="stats"><div class="stat"><div class="s-icon b">üöö</div><div class="s-label">Livraisons</div><div class="s-val">6</div></div><div class="stat"><div class="s-icon o">üìã</div><div class="s-label">√Ä Pr√©parer</div><div class="s-val">28</div></div><div class="stat"><div class="s-icon a">üß∫</div><div class="s-label">Partiels</div><div class="s-val">7</div></div><div class="stat"><div class="s-icon g">‚úÖ</div><div class="s-label">Pr√™ts (E)</div><div class="s-val">12</div></div></div>
<div class="row2"><div class="card"><div class="ch"><span class="ct">üöö Livreries</span></div><div class="cb"><div style="padding:14px;background:var(--inp);border-radius:var(--r);margin-bottom:10px" class="flex-b"><div><div class="fw6">Ridex</div><div class="xs muted">~08:00 ¬∑ 4 POs</div></div>${bd('SHIPPED')}</div><div style="padding:14px;background:var(--inp);border-radius:var(--r)" class="flex-b"><div><div class="fw6">AutoPartner</div><div class="xs muted">~09:30 ¬∑ 2 POs</div></div>${bd('SHIPPED')}</div><button class="btn btn-ac btn-full mt16" onclick="go('warehouse')">D√©marrer R√©ception ‚Üí</button></div></div><div class="card"><div class="ch"><span class="ct">üìã File Pr√©paration</span></div><div class="cb">${OD.filter(o=>['CONFIRMED','PREPARING'].includes(o.st)).map(o=>`<div class="flex-b mb8" style="padding:10px;border:1.5px solid var(--bd);border-radius:var(--r)"><div><div class="mono fw6">${o.n}</div><div class="xs muted">${o.cu} ¬∑ ${o.ln} articles</div></div><div class="flex gap8">${bd(o.st)}<button class="btn btn-xs btn-ac" onclick="go('picking')">Pr√©parer</button></div></div>`).join('')}</div></div></div><div class="al al-e mt16">‚ö†Ô∏è 1 article en Zone Q (Quarantaine)</div>`};

G.catalog=function(){cr('Catalogue');
const rows=PR.map(p=>{const src=p.ext?`<span class="b b-${p.ld==='J+1'?'bl':'or'}">${p.ld}</span> <span class="xs muted">${p.sup}</span>`:'<span class="src src-i">Stock</span>';const avail=p.ext?`<span class="mono">${p.ld}</span>`:`${p.stk}${p.rsv?` <span class="xs muted">(${p.rsv}r)</span>`:''}`;return `<tr class="ck" onclick="go('prod-d','${p.id}')"><td class="mono fw6">${p.sk}</td><td><div class="fw6">${p.nm}</div><div class="xs muted">${p.br} ¬∑ ${p.ct}</div></td><td>${src}</td><td class="mono tr">${avail}</td><td class="mono tr">${E(p.sell)}</td><td>${p.ext?'<span class="b b-bl">EXT</span>':p.stk<=p.thr?(p.stk===0?'<span class="b b-rd">RUPTURE</span>':'<span class="b b-or">BAS</span>'):'<span class="b b-gn">OK</span>'}</td></tr>`}).join('');
const extCnt=PR.filter(p=>p.ext).length;const j1=PR.filter(p=>p.ld==='J+1').length;const j2=PR.filter(p=>p.ld==='J+2').length;
return `<div class="page-head"><div><h1>Catalogue Produits</h1><p class="desc">${PR.length} produits ¬∑ ${PR.length-extCnt} en stock ¬∑ ${j1} √† J+1 ¬∑ ${j2} √† J+2</p></div><div class="actions"><button class="btn btn-gh" onclick="go('vehicle')">üöó V√©hicule</button>${['ADMIN','OWNER','MANAGER'].includes(R)?'<button class="btn btn-ac" onclick="showProdModal()">+ Ajouter</button>':''}</div></div><div class="al al-i mb16">üí° <strong>Stock</strong> = disponible imm√©diatement ¬∑ <strong>J+1</strong> = livr√© demain (fournisseur) ¬∑ <strong>J+2</strong> = 2 jours ouvr√©s (fournisseur)</div><div class="card"><div class="tbar"><div class="filters"><input class="fi" placeholder="Rechercher‚Ä¶" style="min-width:250px" oninput="filt('cat-t',this)"><select class="fi"><option>Toutes dispo.</option><option>En stock</option><option>J+1</option><option>J+2</option></select></div><button class="btn btn-xs btn-gh">Exporter</button></div><div class="tw"><table id="cat-t"><thead><tr><th>R√©f</th><th>Produit</th><th>Disponibilit√©</th><th class="tr">Stock / D√©lai</th><th class="tr">Vente HT</th><th>Statut</th></tr></thead><tbody>${rows}</tbody></table></div><div class="tfoot"><span>${PR.length-extCnt} en stock ¬∑ ${j1} √† J+1 ¬∑ ${j2} √† J+2</span></div></div>`};

G['prod-d']=function(id){const p=PR.find(x=>x.id===id)||PR[0];cr('Catalogue',p.sk);const mg=((p.sell-p.buy)/p.sell*100).toFixed(1);
return `<div class="page-head"><div><h1>${p.nm}</h1><p class="desc">${p.sk} ¬∑ ${p.br} ¬∑ ${p.ct}</p></div><div class="actions"><button class="btn btn-gh" onclick="go('catalog')">‚Üê Retour</button></div></div>
<div class="row21"><div><div class="card"><div class="ch"><span class="ct">Informations</span></div><div class="cb"><div class="dg"><div class="dl">SKU</div><div class="dv mono fw6">${p.sk}</div><div class="dl">EAN</div><div class="dv mono">${p.ean}</div><div class="dl">Marque</div><div class="dv">${p.br}</div><div class="dl">Cat√©gorie</div><div class="dv">${p.ct}</div><div class="dl">Fournisseur</div><div class="dv">${p.sup}</div><div class="dl">Emplacement</div><div class="dv"><span class="loc">${p.loc}</span></div></div></div></div>
<div class="card"><div class="ch"><span class="ct">Disponibilit√© Multi-Source</span></div><div class="cb np"><div class="tw"><table><thead><tr><th>Source</th><th>Fournisseur</th><th class="tr">Dispo.</th><th>D√©lai</th><th class="tr">Achat HT</th></tr></thead><tbody><tr><td><span class="src src-i">INT</span></td><td>Interne</td><td class="mono tr fw6">${p.stk-p.rsv}</td><td>Maint.</td><td class="mono tr">${E(p.buy)}</td></tr><tr><td><span class="src src-e">EXT</span></td><td>Ridex</td><td class="mono tr">45</td><td>J+1</td><td class="mono tr">${E(p.buy*.95)}</td></tr><tr><td><span class="src src-e">EXT</span></td><td>AutoPartner</td><td class="mono tr">22</td><td>J+1</td><td class="mono tr">${E(p.buy*1.05)}</td></tr><tr><td><span class="src src-e">EXT</span></td><td>PSH</td><td class="mono tr">18</td><td>J+1</td><td class="mono tr">${E(p.buy*1.02)}</td></tr></tbody></table></div></div></div></div>
<div><div class="card"><div class="ch"><span class="ct">Stock & Tarification</span></div><div class="cb"><div class="dg"><div class="dl">Total</div><div class="dv mono fw7" style="font-size:22px">${p.stk}</div><div class="dl">R√©serv√©</div><div class="dv mono">${p.rsv}</div><div class="dl">Disponible</div><div class="dv mono fw6">${p.stk-p.rsv}</div><div class="dl">Seuil</div><div class="dv mono">${p.thr}</div><div class="dl">Statut</div><div class="dv">${p.stk<=p.thr?'<span class="b b-rd">BAS</span>':'<span class="b b-gn">OK</span>'}</div></div><hr class="divider"><div class="dg"><div class="dl">Achat HT</div><div class="dv mono">${E(p.buy)}</div><div class="dl">Vente HT</div><div class="dv mono fw6">${E(p.sell)}</div><div class="dl">Vente TTC</div><div class="dv mono fw7">${E(p.sell*1.2)}</div><div class="dl">Marge</div><div class="dv"><span class="b b-gn">${mg}%</span></div></div></div></div></div></div>`};

G.vehicle=function(){cr('Catalogue','Recherche V√©hicule');
return `<div class="page-head"><div><h1>üöó Recherche V√©hicule (TecCom)</h1></div><button class="btn btn-gh" onclick="go('catalog')">‚Üê Catalogue</button></div><div class="card mb16"><div class="cb"><div class="inline-f"><div class="fg"><label>Marque</label><select class="fi" style="width:100%"><option>Peugeot</option><option>Renault</option></select></div><div class="fg"><label>Mod√®le</label><select class="fi" style="width:100%"><option>308</option></select></div><div class="fg"><label>Ann√©e</label><select class="fi" style="width:100%"><option>2019</option></select></div><div class="fg"><label>Moteur</label><select class="fi" style="width:100%"><option>1.6 HDi 115cv</option></select></div><div class="fg" style="flex:0"><label>&nbsp;</label><button class="btn btn-ac" onclick="toast('R√©sultats charg√©s','ok')">Rechercher</button></div></div></div></div><div class="al al-i mb16">üöó Peugeot 308 1.6 HDi ‚Äî 4 pi√®ces</div><div class="card"><div class="cb np"><div class="tw"><table><thead><tr><th>Corresp.</th><th>Produit</th><th>Source</th><th class="tr">Dispo.</th><th class="tr">TTC</th><th></th></tr></thead><tbody><tr><td><span class="b b-gn">EXACT</span></td><td class="fw6">Plaquettes Brembo P06075</td><td><span class="src src-i">INT</span></td><td class="mono tr">12</td><td class="mono tr fw6">945 ‚Ç¨</td><td><button class="btn btn-xs btn-ac" onclick="toast('Ajout√©','ok')">Ajouter</button></td></tr><tr><td><span class="b b-gn">EXACT</span></td><td class="fw6">Disque Brembo 09.A820.11</td><td><span class="src src-e">EXT</span></td><td class="mono tr">18</td><td class="mono tr fw6">1 428 ‚Ç¨</td><td><button class="btn btn-xs btn-ac" onclick="toast('Ajout√©','ok')">Ajouter</button></td></tr><tr><td><span class="b b-bl">COMPAT.</span></td><td class="fw6">Filtre Mann HU716/2x</td><td><span class="src src-i">INT</span></td><td class="mono tr">4</td><td class="mono tr fw6">262.50 ‚Ç¨</td><td><button class="btn btn-xs btn-ac" onclick="toast('Ajout√©','ok')">Ajouter</button></td></tr><tr><td><span class="b b-gr">ALT</span></td><td class="fw6">Kit plaquettes Bosch 0986494524</td><td><span class="src src-i">INT</span></td><td class="mono tr">2</td><td class="mono tr fw6">798 ‚Ç¨</td><td><button class="btn btn-xs btn-ac" onclick="toast('Ajout√©','ok')">Ajouter</button></td></tr></tbody></table></div></div></div>`};
G.orders=function(){cr('Commandes');
const rows=OD.map(o=>`<tr class="ck" onclick="go('order-d','${o.id}')"><td class="mono fw6">${o.n}</td><td>${o.cu}</td><td>${bd(o.st)}</td><td>${o.tp}</td><td>${o.dm||'‚Äî'}</td><td class="mono tr fw6">${E(o.ttc)}</td><td>${bd(o.pay)}</td><td class="muted">${o.dt}</td></tr>`).join('');
return `<div class="page-head"><div><h1>Commandes</h1><p class="desc">${OD.length} commandes</p></div><button class="btn btn-ac" onclick="go('order-new')">+ Nouvelle Commande</button></div><div class="card"><div class="tbar"><div class="filters"><input class="fi" placeholder="Rechercher‚Ä¶" oninput="filt('ord-t',this)"><select class="fi" onchange="filt('ord-t',this)"><option value="">Tous les statuts</option><option>CREATED</option><option>CONFIRMED</option><option>DELIVERED</option><option>CANCELLED</option></select></div></div><div class="tw"><table id="ord-t"><thead><tr><th>N¬∞ Commande</th><th>Client</th><th>Statut</th><th>Type</th><th>Livraison</th><th class="tr">TTC</th><th>Paiement</th><th>Date</th></tr></thead><tbody>${rows}</tbody></table></div></div>`};

G['order-new']=function(){cr('Commandes','Nouvelle');
return `<div class="page-head"><div><h1>Cr√©er Commande</h1><p class="desc">Multi-source avec agr√©gation fournisseurs</p></div><button class="btn btn-gh" onclick="go('orders')">‚Üê Annuler</button></div><div class="row21"><div><div class="card mb16"><div class="ch"><span class="ct">1. Client</span></div><div class="cb"><div class="fg"><label>Type Client</label><select class="fi" style="width:100%"><option>B2B ‚Äî Existant</option><option>B2B ‚Äî Nouveau (cr√©ation)</option><option>B2C ‚Äî Existant</option><option>B2C ‚Äî Nouveau (comptoir)</option></select></div><select class="fi" style="width:100%"><option>‚Äî S√©lectionner ‚Äî</option>${CU.filter(c=>c.tp==='B2B'&&c.st==='ACTIVE').map(c=>`<option>${c.nm} (${c.grid})</option>`).join('')}<option>Comptoir</option></select><div class="al al-i mt8">üí° Grille tarifaire appliqu√©e automatiquement</div></div></div><div class="card mb16"><div class="ch"><span class="ct">2. Recherche</span></div><div class="cb"><div class="inline-f mb12"><div class="fg"><input class="fi" placeholder="Rechercher produits‚Ä¶" style="width:100%"></div><div class="fg" style="flex:0"><button class="btn btn-ac">Rechercher</button></div><div class="fg" style="flex:0"><button class="btn btn-gh" onclick="go('vehicle')">üöó</button></div></div><div class="cutoff" id="cutoff-bar">‚è∞ Ridex: <strong id="cutoff-time">‚Äî</strong> ¬∑ AutoPartner: 5h42m ¬∑ PSH: 2h42m</div></div></div><div class="card"><div class="ch"><span class="ct">3. Panier</span><span class="b b-bl">3 articles</span></div><div class="cb np"><div class="tw"><table><thead><tr><th>Produit</th><th>Src</th><th class="tr">Qt√©</th><th class="tr">Unit√©</th><th class="tr">Ligne</th><th></th></tr></thead><tbody><tr><td><div class="fw6">Plaquettes Brembo P06075</div><div class="xs muted">BRK-001</div></td><td><span class="src src-i">INT</span></td><td class="tr"><input type="number" value="3" min="1" style="width:48px;text-align:center;border:1.5px solid var(--bd);border-radius:4px;padding:4px;font-family:var(--mo)"></td><td class="mono tr">787.50 ‚Ç¨</td><td class="mono tr fw6">2 362.50 ‚Ç¨</td><td><button class="btn-link" style="color:var(--rd)" onclick="this.closest('tr').remove();toast('Supprim√©','wn')">‚úï</button></td></tr><tr><td><div class="fw6">Disque Brembo 09.A820.11</div><div class="xs muted">DSK-019 ¬∑ PSH J+1</div></td><td><span class="src src-e">EXT</span></td><td class="tr"><input type="number" value="2" min="1" style="width:48px;text-align:center;border:1.5px solid var(--bd);border-radius:4px;padding:4px;font-family:var(--mo)"></td><td class="mono tr">1 190 ‚Ç¨</td><td class="mono tr fw6">2 380 ‚Ç¨</td><td><button class="btn-link" style="color:var(--rd)" onclick="this.closest('tr').remove();toast('Supprim√©','wn')">‚úï</button></td></tr><tr><td><div class="fw6">Filtre Mann HU716/2x</div><div class="xs muted">FLT-042</div></td><td><span class="src src-i">INT</span></td><td class="tr"><input type="number" value="2" min="1" style="width:48px;text-align:center;border:1.5px solid var(--bd);border-radius:4px;padding:4px;font-family:var(--mo)"></td><td class="mono tr">12.50 ‚Ç¨</td><td class="mono tr fw6">25.00 ‚Ç¨</td><td><button class="btn-link" style="color:var(--rd)" onclick="this.closest('tr').remove();toast('Supprim√©','wn')">‚úï</button></td></tr></tbody></table></div></div></div></div><div><div class="card" style="position:sticky;top:24px"><div class="ch"><span class="ct">R√©sum√©</span></div><div class="cb"><div class="dg mb12"><div class="dl">Sous-total HT</div><div class="dv mono tr">296.00 ‚Ç¨</div><div class="dl">Remise</div><div class="dv mono tr">0.00 ‚Ç¨</div><div class="dl">TVA (20%)</div><div class="dv mono tr">59.20 ‚Ç¨</div></div><div class="flex-b" style="font-size:18px;font-weight:700;padding:12px 0;border-top:2px solid var(--t1)"><span>Total TTC</span><span class="mono">355.20 ‚Ç¨</span></div><hr class="divider"><div class="fg"><label>Mode Livraison</label><select class="fi" style="width:100%"><option>PARTIEL ‚Äî Stock maintenant, reste J+1</option><option>COMPLET ‚Äî Tout √† J+1</option></select></div><button class="btn btn-ac btn-full mb8" onclick="toast('Commande ORD-2026-00192 cr√©√©e','ok');go('orders')">Cr√©er Commande</button><button class="btn btn-gh btn-full mb8" onclick="toast('Devis enregistr√©','ok');go('quotes')">Enregistrer comme Devis</button>${R==='COUNTER_AGENT'?'<button class="btn btn-gn btn-full mb8" onclick="toast(\'Paid via Stripe\',\'ok\')">üí≥ Payer (Stripe)</button><button class="btn-link" onclick="openDiscModal()" style="display:block;text-align:center;margin-top:4px">üè∑Ô∏è Demander Remise</button>':''}</div></div></div></div>`};

G['order-d']=function(id){const o=OD.find(x=>x.id===id)||OD[0];cr('Commandes',o.n);
const acts=[o.st==='CREATED'?'<button class="btn btn-bl" onclick="toast(\'Confirmed\',\'ok\')">‚úì Confirmer</button>':'',o.st==='CONFIRMED'?'<button class="btn btn-ac" onclick="toast(\'Preparing\',\'ok\')">üìã Pr√©parer</button>':'',o.st==='READY'?'<button class="btn btn-gn" onclick="toast(\'Delivered\',\'ok\')">üöö Livrer</button>':'',['CREATED','CONFIRMED'].includes(o.st)?'<button class="btn btn-rd" onclick="showCfm(\'Annuler ?\',\'Lib√©rer le stock ?\',()=>toast(\'Cancelled\',\'wn\'))">Annuler</button>':''].filter(Boolean).join('');
const disc=o.disc?`<div class="al al-w mb16">üè∑Ô∏è <strong>${o.disc.pct}%</strong> ‚Äî ${bd(o.disc.st)} ${['OWNER','MANAGER','ADMIN'].includes(R)&&o.disc.st==='PENDING_APPROVAL'?`<div class="flex gap8" style="margin-left:auto"><button class="btn btn-xs btn-gn" onclick="toast('Approuv√©','ok')">Approuver</button><button class="btn btn-xs btn-rd" onclick="toast('Rejet√©','wn')">Rejeter</button></div>`:''}</div>`:'';
return `<div class="page-head"><div><h1>${o.n}</h1><p class="desc">${o.cu} ¬∑ ${o.tp} ¬∑ ${o.dt}</p></div><div class="actions"><button class="btn btn-gh" onclick="go('orders')">‚Üê Retour</button>${acts}</div></div>${disc}<div class="row21"><div><div class="card mb16"><div class="ch"><span class="ct">D√©tails</span>${bd(o.st)}</div><div class="cb"><div class="dg"><div class="dl">N¬∞ Commande</div><div class="dv mono fw7">${o.n}</div><div class="dl">Client</div><div class="dv"><span class="link" onclick="go('cust-d','${CU.find(c=>c.nm===o.cu)?.id||'C1'}')">${o.cu}</span></div><div class="dl">Type</div><div class="dv">${o.tp}</div><div class="dl">Livraison</div><div class="dv">${o.dm||'‚Äî'}</div><div class="dl">Paiement</div><div class="dv">${bd(o.pay)}</div><div class="dl">Par</div><div class="dv">${o.by}</div>${o.inv?`<div class="dl">Facture</div><div class="dv"><span class="link" onclick="go('inv-d','${IV.find(i=>i.n===o.inv)?.id||'I1'}')">${o.inv}</span></div>`:''}</div></div></div><div class="card"><div class="ch"><span class="ct">Lignes</span><span class="b b-gr">${o.ln}</span></div><div class="cb np"><table><thead><tr><th>Produit</th><th>Src</th><th class="tr">Qt√©</th><th class="tr">Unit√©</th><th class="tr">Total</th></tr></thead><tbody><tr><td class="fw6">Plaquettes Brembo P06075</td><td><span class="src src-i">INT</span></td><td class="mono tr">3</td><td class="mono tr">787.50 ‚Ç¨</td><td class="mono tr fw6">2 362.50 ‚Ç¨</td></tr><tr><td class="fw6">Disque Brembo 09.A820.11</td><td><span class="src src-e">EXT</span></td><td class="mono tr">2</td><td class="mono tr">1 190 ‚Ç¨</td><td class="mono tr fw6">2 380 ‚Ç¨</td></tr></tbody></table></div></div></div><div><div class="card mb16"><div class="ch"><span class="ct">Totaux</span></div><div class="cb"><div class="dg"><div class="dl">HT</div><div class="dv mono">${E(o.ht)}</div><div class="dl">TVA</div><div class="dv mono">${E(o.ttc-o.ht)}</div></div><div class="flex-b mt8" style="font-size:18px;font-weight:700;padding-top:12px;border-top:2px solid var(--t1)"><span>TTC</span><span class="mono">${E(o.ttc)}</span></div></div></div><div class="card"><div class="ch"><span class="ct">Historique</span></div><div class="cb"><div class="tl"><div class="tl-i d"><div class="tl-t">Cr√©√©</div><div class="tl-m">${o.dt}</div></div>${['CONFIRMED','PREPARING','READY','DELIVERED','PARTIALLY_DELIVERED'].includes(o.st)?'<div class="tl-i d"><div class="tl-t">Confirm√©</div></div>':''}${['PREPARING','READY','DELIVERED'].includes(o.st)?'<div class="tl-i d"><div class="tl-t">En pr√©paration</div></div>':''}${['READY','DELIVERED'].includes(o.st)?'<div class="tl-i d"><div class="tl-t">Pr√™t</div></div>':''}${o.st==='DELIVERED'?'<div class="tl-i d"><div class="tl-t">Livr√©</div></div>':''}${o.st==='CANCELLED'?'<div class="tl-i"><div class="tl-t" style="color:var(--rd)">Annul√©</div></div>':''}</div></div></div></div></div>`};

G.quotes=function(){cr('Devis');
const rows=QU.map(q=>`<tr class="ck" onclick="go('quote-d','${q.id}')"><td class="mono fw6">${q.n}</td><td>${q.cu}</td><td>${bd(q.st)}</td><td class="mono tr">${E(q.ht)}</td><td class="mono tr fw6">${E(q.ttc)}</td><td class="muted">${q.exp}</td></tr>`).join('');
return `<div class="page-head"><div><h1>Devis</h1><p class="desc">${QU.length}</p></div><button class="btn btn-ac" onclick="go('order-new')">+ Nouveau</button></div><div class="card"><div class="tw"><table><thead><tr><th>N¬∞ Devis</th><th>Client</th><th>Statut</th><th class="tr">HT</th><th class="tr">TTC</th><th>Valide jusqu&#39;au</th></tr></thead><tbody>${rows}</tbody></table></div></div>`};

G['quote-d']=function(id){const q=QU.find(x=>x.id===id)||QU[0];cr('Devis',q.n);
const canConvert=['SENT','DRAFT'].includes(q.st);
return `<div class="page-head"><div><h1>${q.n}</h1><p class="desc">${q.cu} ¬∑ ${q.dt}</p></div><div class="actions"><button class="btn btn-gh" onclick="go('quotes')">‚Üê Retour</button>${q.st==='DRAFT'?'<button class="btn btn-bl" onclick="toast(\'Quote sent to customer\',\'ok\')">üìß Envoyer</button>':''}${canConvert?'<button class="btn btn-gn" onclick="toast(\'Order created from quote\',\'ok\');go(\'orders\')">üõí Convertir en Commande</button>':''}</div></div>
<div class="row21"><div><div class="card"><div class="ch"><span class="ct">D√©tails Devis</span>${bd(q.st)}</div><div class="cb"><div class="dg"><div class="dl">N¬∞ Devis</div><div class="dv mono fw7">${q.n}</div><div class="dl">Client</div><div class="dv"><span class="link" onclick="go('cust-d','${CU.find(c=>c.nm===q.cu)?.id||'C1'}')">${q.cu}</span></div><div class="dl">Cr√©√©</div><div class="dv">${q.dt}</div><div class="dl">Valide jusqu&#39;au</div><div class="dv fw6">${q.exp}</div><div class="dl">Lignes</div><div class="dv">${q.ln}</div></div></div></div>
<div class="card"><div class="ch"><span class="ct">Lignes</span></div><div class="cb np"><table><thead><tr><th>Produit</th><th class="tr">Qt√©</th><th class="tr">Unit√© HT</th><th class="tr">Total HT</th></tr></thead><tbody><tr><td class="fw6">Plaquettes Brembo P06075</td><td class="mono tr">2</td><td class="mono tr">787.50 ‚Ç¨</td><td class="mono tr fw6">90.00 ‚Ç¨</td></tr><tr><td class="fw6">Filtre Mann HU716/2x</td><td class="mono tr">4</td><td class="mono tr">12.50 ‚Ç¨</td><td class="mono tr fw6">50.00 ‚Ç¨</td></tr></tbody></table></div></div></div>
<div><div class="card"><div class="ch"><span class="ct">Totaux</span></div><div class="cb"><div class="dg"><div class="dl">HT</div><div class="dv mono">${E(q.ht)}</div><div class="dl">TVA</div><div class="dv mono">${E(q.ttc-q.ht)}</div></div><div class="flex-b mt8" style="font-size:18px;font-weight:700;padding-top:12px;border-top:2px solid var(--t1)"><span>TTC</span><span class="mono">${E(q.ttc)}</span></div></div></div></div></div>`};

G.customers=function(){cr('Clients');
const rows=CU.map(c=>`<tr class="ck" onclick="go('cust-d','${c.id}')"><td class="mono fw6">${c.cd}</td><td><div class="fw6">${c.nm}</div><div class="xs muted">${c.city}</div></td><td>${c.tp}</td><td>${bd(c.st)}</td><td>${c.grid}</td><td>${c.usr}</td></tr>`).join('');
return `<div class="page-head"><div><h1>Clients</h1><p class="desc">${CU.length}</p></div>${['ADMIN','OWNER','MANAGER','COUNTER_AGENT'].includes(R)?'<button class="btn btn-ac" onclick="showCustModal()">+ Nouveau Client</button>':''}</div><div class="card"><div class="tbar"><div class="filters"><input class="fi" placeholder="Rechercher‚Ä¶" oninput="filt('cust-t',this)"><select class="fi"><option>Tous les types</option><option>B2B</option><option>WALK_IN</option></select></div></div><div class="tw"><table id="cust-t"><thead><tr><th>Code</th><th>Soci√©t√©</th><th>Type</th><th>Statut</th><th>Grille</th><th>Utilisateurs</th></tr></thead><tbody>${rows}</tbody></table></div></div>`};

G['cust-d']=function(id){const c=CU.find(x=>x.id===id)||CU[0];cr('Clients',c.nm);
const custOrders=OD.filter(o=>o.cu===c.nm);
return `<div class="page-head"><div><h1>${c.nm}</h1><p class="desc">${c.cd} ¬∑ ${c.tp} ¬∑ ${c.city}</p></div><div class="actions"><button class="btn btn-gh" onclick="go('customers')">‚Üê Retour</button>${c.st==='SUSPENDED'?'<button class="btn btn-gn" onclick="toast(\'Reactivated\',\'ok\')">R√©activer</button>':''}${c.st==='ACTIVE'&&['ADMIN','OWNER','MANAGER'].includes(R)?'<button class="btn btn-rd" onclick="showCfm(\'Suspendre ?\',\'Le client ne pourra plus commander\',()=>toast(\'Suspended\',\'wn\'))">Suspendre</button>':''}</div></div>
<div class="tabs" id="ct-tabs"><button class="tab on" onclick="ctTab(0,this)">Infos</button><button class="tab" onclick="ctTab(1,this)">Tarification</button><button class="tab" onclick="ctTab(2,this)">Orders (${custOrders.length})</button>${c.tp==='B2B'?'<button class="tab" onclick="ctTab(3,this)">Utilisateurs B2B</button>':''}</div>
<div class="tab-c on" id="ct-0"><div class="row21"><div class="card"><div class="cb"><div class="dg"><div class="dl">Soci√©t√©</div><div class="dv fw6">${c.nm}</div><div class="dl">Code</div><div class="dv mono">${c.cd}</div><div class="dl">SIRET</div><div class="dv mono">${c.siret}</div><div class="dl">Statut</div><div class="dv">${bd(c.st)}</div><div class="dl">Adresse</div><div class="dv">${c.addr}</div><div class="dl">Email</div><div class="dv">${c.em}</div><div class="dl">T√©l√©phone</div><div class="dv">${c.ph}</div><div class="dl">Commercial</div><div class="dv">${c.rep}</div></div></div></div><div class="card"><div class="cb"><div class="dg"><div class="dl">Grille</div><div class="dv fw6">${c.grid}</div><div class="dl">Remise globale</div><div class="dv mono fw7">${c.disc}%</div><div class="dl">Utilisateurs B2B</div><div class="dv">${c.usr}</div></div></div></div></div></div>
<div class="tab-c" id="ct-1"><div class="card"><div class="cb"><div class="dg"><div class="dl">Grille</div><div class="dv fw7">${c.grid}</div><div class="dl">Global</div><div class="dv mono fw6">${c.disc}%</div><div class="dl">Freinage</div><div class="dv mono">${c.disc>7?'15%':'10%'}</div><div class="dl">Filtration</div><div class="dv mono">${c.disc>7?'12%':'8%'}</div></div></div></div></div>
<div class="tab-c" id="ct-2">${custOrders.length?`<div class="card"><div class="cb np"><table><thead><tr><th>Commande</th><th>Statut</th><th class="tr">TTC</th><th>Date</th></tr></thead><tbody>${custOrders.map(o=>`<tr class="ck" onclick="go('order-d','${o.id}')"><td class="mono fw6">${o.n}</td><td>${bd(o.st)}</td><td class="mono tr fw6">${E(o.ttc)}</td><td class="muted">${o.dt}</td></tr>`).join('')}</tbody></table></div></div>`:'<div class="empty"><div class="ei">üìã</div><h3>Aucune commande</h3></div>'}</div>
<div class="tab-c" id="ct-3"><div class="card"><div class="cb np"><table><thead><tr><th>Nom</th><th>Email</th><th>R√¥le</th><th>Statut</th></tr></thead><tbody><tr><td class="fw6">Pierre Martin</td><td class="mono sm">pierre@garagemartin.fr</td><td>${bd('B2B_OWNER')}</td><td>${bd('ACTIVE')}</td></tr><tr><td>Jean Acheteur</td><td class="mono sm">jean@garagemartin.fr</td><td>${bd('B2B_BUYER')}</td><td>${bd('ACTIVE')}</td></tr><tr><td>Lucie Vue</td><td class="mono sm">lucie@garagemartin.fr</td><td>${bd('B2B_VIEWER')}</td><td>${bd('ACTIVE')}</td></tr></tbody></table></div></div></div>`};
function ctTab(i,el){document.querySelectorAll('#ct-tabs .tab').forEach(t=>t.classList.remove('on'));el.classList.add('on');for(let j=0;j<4;j++){const e=document.getElementById('ct-'+j);if(e)e.classList.toggle('on',j===i)}}
G.suppliers=function(){cr('Fournisseurs');
const rows=SP.map(s=>`<tr class="ck" onclick="go('sup-d','${s.id}')"><td class="mono fw6">${s.cd}</td><td class="fw6">${s.nm}</td><td>${s.api?`<span class="b b-gn">${s.tp}</span>`:'<span class="b b-gr">MANUAL</span>'}</td><td class="tc">${s.pri}</td><td class="mono">${s.cut}</td><td>J+${s.ld}</td><td><div class="prog" style="width:80px;display:inline-block;vertical-align:middle"><div class="pf ${s.rel>=95?'g':'b'}" style="width:${s.rel}%"></div></div> <span class="xs muted">${s.rel}%</span></td></tr>`).join('');
return `<div class="page-head"><div><h1>Fournisseurs</h1><p class="desc">${SP.length}</p></div></div><div class="card"><div class="tw"><table><thead><tr><th>Code</th><th>Nom</th><th>API</th><th class="tc">Prio</th><th>Cut-off</th><th>D√©lai</th><th>Fiabilit√©</th></tr></thead><tbody>${rows}</tbody></table></div></div>`};

G['sup-d']=function(id){const s=SP.find(x=>x.id===id)||SP[0];cr('Fournisseurs',s.nm);
const supPOs=PL.filter(p=>p.su.startsWith(s.nm.split(' ')[0]));
return `<div class="page-head"><div><h1>${s.nm}</h1><p class="desc">${s.cd} ¬∑ Priority ${s.pri}</p></div><div class="actions"><button class="btn btn-gh" onclick="go('suppliers')">‚Üê Retour</button>${R==='OWNER'?'<button class="btn btn-bl" onclick="toast(\'Config saved\',\'ok\')">Enregistrer</button>':''}<button class="btn btn-ac" onclick="go('sup-compare')">‚öñÔ∏è Compare</button></div></div>
<div class="tabs" id="spt"><button class="tab on" onclick="stb(0,this)">Infos</button><button class="tab" onclick="stb(1,this)">Config API</button><button class="tab" onclick="stb(2,this)">PO History (${supPOs.length})</button><button class="tab" onclick="stb(3,this)">Performance</button></div>
<div class="tab-c on" id="st-0"><div class="row21"><div class="card"><div class="cb"><div class="dg"><div class="dl">Code</div><div class="dv mono fw6">${s.cd}</div><div class="dl">Nom</div><div class="dv fw6">${s.nm}</div><div class="dl">Priorit√©</div><div class="dv">${s.pri}</div><div class="dl">Cut-off</div><div class="dv mono fw6">${s.cut}</div><div class="dl">D√©lai</div><div class="dv">J+${s.ld}</div><div class="dl">Contact</div><div class="dv">${s.ct}</div><div class="dl">Email</div><div class="dv">${s.em}</div><div class="dl">T√©l√©phone</div><div class="dv">${s.ph}</div><div class="dl">Statut</div><div class="dv">${s.api?bd('ACTIVE'):bd('MANUAL')}</div></div></div></div><div class="card"><div class="cb"><div class="dg"><div class="dl">Fiabilit√©</div><div class="dv"><div class="prog" style="width:120px"><div class="pf ${s.rel>=95?'g':'b'}" style="width:${s.rel}%"></div></div>${s.rel}%</div><div class="dl">POs YTD</div><div class="dv mono fw6">${12+s.pri*3}</div></div></div></div></div></div>
<div class="tab-c" id="st-1"><div class="card"><div class="ch"><span class="ct">Configuration API ‚Äî SCR-SUP-001</span>${s.api?'<span class="b b-gn">CONNECTED</span>':'<span class="b b-rd">NOT CONFIGURED</span>'}</div><div class="cb">${R==='OWNER'?`<div class="grid-f mb16"><div class="fg"><label>Type API</label><select class="fi" style="width:100%"><option ${s.tp==='REST'?'selected':''}>REST</option><option ${s.tp==='SOAP'?'selected':''}>SOAP</option><option>FILE/FTP</option></select></div><div class="fg"><label>URL Base</label><input class="fi" style="width:100%" value="${s.api?'https://api.'+s.cd.toLowerCase()+'.fr/v2':''}"></div><div class="fg"><label>Auth</label><select class="fi" style="width:100%"><option>OAuth2</option><option>API Key</option><option>Basic</option></select></div><div class="fg"><label>Client ID</label><input class="fi" style="width:100%" value="${s.api?s.cd+'_prod_****':''}"></div><div class="fg"><label>Secret</label><input type="password" class="fi" style="width:100%" value="${s.api?'‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢':''}"></div><div class="fg"><label>Timeout (ms)</label><input type="number" class="fi" style="width:100%" value="5000"></div></div><div class="al al-i mb12">Adaptateur : queryAvailability(refs[]) ¬∑ submitOrder(data) ¬∑ getOrderStatus(id) ¬∑ cancelOrder(id)</div><button class="btn btn-bl" onclick="toast('‚úÖ Connection OK ‚Äî 142ms','ok')">üîå Tester Connexion</button>`:`<div class="al al-w">Seul le OWNER peut modifier la config API</div>`}</div></div></div>
<div class="tab-c" id="st-2">${supPOs.length?`<div class="card"><div class="cb np"><table><thead><tr><th>N¬∞ BC</th><th>Statut</th><th>R√©f</th><th class="tr">HT</th><th>Date</th></tr></thead><tbody>${supPOs.map(p=>`<tr class="ck" onclick="go('po-d','${p.id}')"><td class="mono fw6">${p.n}</td><td>${bd(p.st)}</td><td class="mono xs">${p.ref}</td><td class="mono tr fw6">${E(p.ht)}</td><td class="muted">${p.dt}</td></tr>`).join('')}</tbody></table></div></div>`:'<div class="empty"><div class="ei">üìã</div><h3>Aucun BC</h3></div>'}</div>
<div class="tab-c" id="st-3"><div class="stats"><div class="stat"><div class="s-icon g">üì¶</div><div class="s-label">Ponctualit√©</div><div class="s-val">${s.rel}%</div></div><div class="stat"><div class="s-icon b">‚è±Ô∏è</div><div class="s-label">D√©lai Moy.</div><div class="s-val">${s.ld}d</div></div><div class="stat"><div class="s-icon o">‚ö†Ô∏è</div><div class="s-label">Variance</div><div class="s-val">${100-s.rel}%</div></div><div class="stat"><div class="s-icon a">üìä</div><div class="s-label">BC (ann√©e)</div><div class="s-val">${12+s.pri*3}</div></div></div></div>`}
function stb(i,el){document.querySelectorAll('#spt .tab').forEach(t=>t.classList.remove('on'));el.classList.add('on');for(let j=0;j<4;j++){const e=document.getElementById('st-'+j);if(e)e.classList.toggle('on',j===i)}};

G.po=function(){cr('Bons de Commande');
const rows=PL.map(p=>`<tr class="ck" onclick="go('po-d','${p.id}')"><td class="mono fw6">${p.n}</td><td>${p.su}</td><td>${bd(p.st)}</td><td class="mono">${p.ref}</td><td class="mono tr fw6">${E(p.ht)}</td><td class="muted">${p.exp}</td></tr>`).join('');
return `<div class="page-head"><div><h1>Bons de Commande</h1><p class="desc">${PL.length}</p></div><div class="actions">${['PURCHASER','OWNER','ADMIN','MANAGER'].includes(R)?'<button class="btn btn-gh" onclick="go(\'sup-compare\')">‚öñÔ∏è Compare</button><button class="btn btn-ac" onclick="toast(\'New PO\',\'in\')">+ Nouveau BC</button>':''}</div></div>${PL.find(p=>p.st==='PENDING_APPROVAL')?'<div class="al al-w mb16">‚ö†Ô∏è PO-2026-00045 (27 500 ‚Ç¨) en attente d&#39;approbation</div>':''}<div class="card"><div class="tbar"><div class="filters"><input class="fi" placeholder="Rechercher‚Ä¶" oninput="filt(\'po-t\',this)"></div></div><div class="tw"><table id="po-t"><thead><tr><th>N¬∞ BC</th><th>Fournisseur</th><th>Statut</th><th>R√©f</th><th class="tr">HT</th><th>Pr√©vu</th></tr></thead><tbody>${rows}</tbody></table></div></div>`};

G['po-d']=function(id){const p=PL.find(x=>x.id===id)||PL[0];cr('BC',p.n);
const canApprove=p.st==='PENDING_APPROVAL'&&['OWNER','MANAGER','ADMIN'].includes(R);
const canSubmit=p.st==='DRAFT'&&['PURCHASER','OWNER'].includes(R);
return `<div class="page-head"><div><h1>${p.n}</h1><p class="desc">${p.su} ¬∑ ${p.dt}</p></div><div class="actions"><button class="btn btn-gh" onclick="go('po')">‚Üê Retour</button>${canApprove?'<button class="btn btn-gn" onclick="toast(\'Approved\',\'ok\')">‚úì Approuver</button><button class="btn btn-rd" onclick="toast(\'Rejected\',\'wn\')">‚úï Rejeter</button>':''}${canSubmit?'<button class="btn btn-bl" onclick="toast(\'Submitted via '+p.su+' API\',\'ok\')">üì§ Soumettre via API</button>':''}${p.st==='CONFIRMED'?'<button class="btn btn-gh" onclick="showCfm(\'Annuler le BC ?\',\'Avant confirmation fournisseur\',()=>toast(\'Cancelled\',\'wn\'))">Annuler</button>':''}${p.st==='SHIPPED'?'<button class="btn btn-ac" onclick="go(\'warehouse\')">üì¶ R√©ceptionner</button>':''}</div></div>
<div class="al al-i mb16">Flux statut : <strong>Brouillon ‚Üí Soumis (API) ‚Üí Confirm√© ‚Üí Exp√©di√© ‚Üí Partiellement re√ßu ‚Üí Re√ßu</strong></div>
<div class="row21"><div><div class="card"><div class="ch"><span class="ct">D√©tails</span>${bd(p.st)}</div><div class="cb"><div class="dg"><div class="dl">PO #</div><div class="dv mono fw7">${p.n}</div><div class="dl">Fournisseur</div><div class="dv"><span class="link" onclick="go('sup-d','${SP.find(s=>s.nm.startsWith(p.su.split(' ')[0]))?.id||'S1'}')">${p.su}</span></div><div class="dl">R√©f Fournisseur</div><div class="dv mono">${p.ref}</div><div class="dl">Pr√©vu</div><div class="dv fw6">${p.exp}</div><div class="dl">Lignes</div><div class="dv">${p.ln}</div>${p.st==='CONFIRMED'||p.st==='SHIPPED'?`<div class="dl">N¬∞ Confirm. API</div><div class="dv mono">${p.ref!=='‚Äî'?p.ref+'-CONF':'‚Äî'}</div><div class="dl">Livraison est.</div><div class="dv">${p.exp}</div>`:''}</div></div></div>
<div class="card"><div class="ch"><span class="ct">Lignes</span></div><div class="cb np"><table><thead><tr><th>Produit</th><th class="tr">Qt√©</th><th class="tr">Achat HT</th><th class="tr">Total</th>${p.st==='SHIPPED'||p.st==='RECEIVED'?'<th class="tr">Re√ßu</th>':''}</tr></thead><tbody><tr><td class="fw6">Plaquettes Brembo P06075</td><td class="mono tr">10</td><td class="mono tr">22.50 ‚Ç¨</td><td class="mono tr fw6">3 937.50 ‚Ç¨</td>${p.st==='SHIPPED'||p.st==='RECEIVED'?'<td class="mono tr">‚Äî</td>':''}</tr><tr><td class="fw6">Bougie Bosch 0242236571</td><td class="mono tr">20</td><td class="mono tr">3.50 ‚Ç¨</td><td class="mono tr fw6">1 225.00 ‚Ç¨</td>${p.st==='SHIPPED'||p.st==='RECEIVED'?'<td class="mono tr">‚Äî</td>':''}</tr></tbody></table></div></div></div>
<div><div class="card"><div class="ch"><span class="ct">Totaux</span></div><div class="cb"><div class="dg"><div class="dl">Total HT</div><div class="dv mono fw7" style="font-size:20px">${E(p.ht)}</div></div></div></div>
<div class="card"><div class="ch"><span class="ct">Historique</span></div><div class="cb"><div class="tl"><div class="tl-i d"><div class="tl-t">Cr√©√©</div><div class="tl-m">${p.dt}</div></div>${['CONFIRMED','SHIPPED','RECEIVED'].includes(p.st)?'<div class="tl-i d"><div class="tl-t">Soumis via API</div></div>':''}${['CONFIRMED','SHIPPED','RECEIVED'].includes(p.st)?'<div class="tl-i d"><div class="tl-t">Confirm√© par fournisseur</div></div>':''}${['SHIPPED','RECEIVED'].includes(p.st)?'<div class="tl-i d"><div class="tl-t">Exp√©di√©</div></div>':''}${p.st==='RECEIVED'?'<div class="tl-i d"><div class="tl-t">Re√ßu</div></div>':''}</div></div></div></div></div>`};

G.stock=function(){cr('Stock');
const rows=PR.map(p=>`<tr class="ck" onclick="go('prod-d','${p.id}')"><td class="mono fw6">${p.sk}</td><td>${p.nm}</td><td class="mono tr fw6">${p.stk}</td><td class="mono tr">${p.rsv}</td><td class="mono tr fw6">${p.stk-p.rsv}</td><td class="mono tr">${p.thr}</td><td><span class="loc" style="font-size:11px">${p.loc}</span></td><td>${p.stk<=p.thr?(p.stk===0?'<span class="b b-rd">RUPTURE</span>':'<span class="b b-or">BAS</span>'):'<span class="b b-gn">OK</span>'}</td></tr>`).join('');
return `<div class="page-head"><div><h1>Stock</h1><p class="desc">${PR.length} ¬∑ Zones A-F</p></div><div class="actions"><button class="btn btn-ac" onclick="go('stock-alerts')">üö® Alerts (${AL.length})</button></div></div>${AL.length?`<div class="al al-e mb16">üö® ${AL.length} alertes ‚Äî ${AL.filter(a=>a.sev==='OUT_OF_STOCK').length} OUT ¬∑ <button class="btn-link" onclick="go('stock-alerts')">Voir tableau alertes ‚Üí</button></div>`:''}<div class="card"><div class="tbar"><div class="filters"><input class="fi" placeholder="Rechercher‚Ä¶" oninput="filt('stk-t',this)"><select class="fi"><option>Tous</option><option>OK</option><option>BAS</option><option>RUPTURE</option></select></div></div><div class="tw"><table id="stk-t"><thead><tr><th>R√©f</th><th>Produit</th><th class="tr">Total</th><th class="tr">R√©s.</th><th class="tr">Dispo</th><th class="tr">Seuil</th><th>Emplacement</th><th>Niveau</th></tr></thead><tbody>${rows}</tbody></table></div></div>`};

G.warehouse=function(){cr('Entrep√¥t','R√©ception');
const L=[{nm:'Plaquettes Brembo P06075',sk:'BRK-001',exp:10,rcv:10,dest:'A-02-03-B (Stock)',ok:1},{nm:'Filtre Mann HU716/2x',sk:'FLT-042',exp:20,rcv:18,dest:'B-01-05-A (Stock)',ok:1},{nm:'Disque Brembo 09.A820.11',sk:'DSK-019',exp:5,rcv:0,dest:'Zone P ‚Üí Garage Martin',ok:0},{nm:'Amortisseur Sachs 314700',sk:'AMR-015',exp:3,rcv:0,dest:'Zone P ‚Üí Garage Dupont',ok:0}];
return `<div class="page-head"><div><h1>üì¶ R√©ception</h1><p class="desc">Zone R</p></div></div><div class="card mb16"><div class="cb"><div class="fg"><label>Scanner N¬∞ BC</label><div class="inline-f"><input class="scan" placeholder="Scanner code-barres ou BC-YYYY-NNNNN‚Ä¶"><button class="btn btn-ac" onclick="toast('BC-2026-00046 charg√©','ok')">Charger</button></div></div></div></div><div class="al al-i mb16">üìã <strong>PO-2026-00046</strong> ‚Äî Ridex ‚Äî 4 lines</div><div class="card"><div class="ch"><span class="ct">Lignes</span><span class="b b-or">2/4</span></div><div class="cb">${L.map(l=>`<div class="pick ${l.ok?'ok':'wt'}"><div class="pick-s ${l.ok?'g':'w'}">${l.ok?'‚úì':'?'}</div><div style="flex:1"><div class="fw6">${l.nm}</div><div class="xs muted">${l.sk} ¬∑ Att: ${l.exp}</div><div class="sm mt4">‚Üí <strong>${l.dest}</strong></div></div><div class="tr">${l.ok?`<span class="mono fw6" style="color:var(--gn)">${l.rcv}/${l.exp}</span>`:`<div class="flex gap4"><input type="number" value="${l.exp}" style="width:56px;text-align:center;border:1.5px solid var(--bd);border-radius:4px;padding:5px;font-family:var(--mo)"><select style="padding:5px;border:1.5px solid var(--bd);border-radius:4px;font-size:12px"><option>OK</option><option>ENDOMMAG√â</option><option>MANQUANT</option></select><button class="btn btn-xs btn-gn" onclick="this.closest('.pick').className='pick ok';toast('Received','ok')">‚úì</button></div>`}</div></div>`).join('')}<div class="flex-b mt16"><button class="btn btn-gh">Scanner Emplacement</button><button class="btn btn-gn" onclick="toast('Termin√© ‚Äî stock mis √† jour','ok')">Terminer</button></div></div></div>`};

G.picking=function(){cr('Entrep√¥t','Pr√©paration');
const it=[{nm:'Plaquettes Brembo P06075',sk:'BRK-001',q:3,loc:'A-02-03-B',ok:1},{nm:'Courroie Gates K015603XS',sk:'BLT-003',q:1,loc:'D-01-02-A',ok:1},{nm:'Bougie Bosch 0242236571',sk:'SPK-010',q:4,loc:'C-03-01-C',ok:0},{nm:'Filtre Mann HU716/2x',sk:'FLT-042',q:2,loc:'B-01-05-A',ok:0}];const dn=it.filter(i=>i.ok).length;
return `<div class="page-head"><div><h1>üìã Pr√©paration</h1><p class="desc">ORD-2026-00188 ¬∑ Serpentin</p></div><button class="btn btn-gh" onclick="go('${R==='WAREHOUSE_KEEPER'?'wh-dash':'warehouse'}')">‚Üê Retour</button></div><div class="prog mb8" style="height:10px"><div class="pf g" style="width:${dn/it.length*100}%"></div></div><div class="flex-b mb16"><span class="fw6">${dn}/${it.length}</span>${bd('PREPARING')}</div><div class="card mb16"><div class="cb"><div class="fg"><label>Scanner EAN</label><input class="scan" placeholder="Scanner‚Ä¶" autofocus></div></div></div>${it.map((x,i)=>`<div class="pick ${x.ok?'ok':'wt'}"><div class="pick-s ${x.ok?'g':'w'}">${x.ok?'‚úì':i+1}</div><div style="flex:1"><div class="fw6">${x.nm}</div><div class="xs muted">${x.sk} ¬∑ Qty: ${x.q}</div><div class="loc mt4">üìç ${x.loc}</div></div><div class="tr">${x.ok?'<span class="b b-gn">PR√âPAR√â</span>':`<button class="btn btn-xs btn-ac" onclick="this.closest('.pick').className='pick ok';this.outerHTML='<span class=\\'b b-gn\\'>PR√âPAR√â</span>';toast('OK','ok')">‚úì</button>`}</div></div>`).join('')}<button class="btn btn-gn btn-full mt16" onclick="toast('Termin√© ‚Üí Zone E','ok')">Terminer</button>`};

G.inventory=function(){cr('Entrep√¥t','Inventaire');
const lc=[{l:'B-01-05-A',p:'Filtre Mann HU716/2x',th:4,ct:null},{l:'B-02-01-C',p:'Filtre air Mann C25117/2',th:15,ct:13},{l:'B-02-03-A',p:'Filtre habitacle CU2436',th:8,ct:8}];
return `<div class="page-head"><div><h1>üì± Inventaire Zone</h1></div></div><div class="card mb16"><div class="cb"><div class="inline-f"><div class="fg"><label>Zone</label><select class="fi"><option>B ‚Äî Filtration</option><option>A ‚Äî Freinage</option></select></div><div class="fg" style="flex:0"><label>&nbsp;</label><button class="btn btn-ac" onclick="toast('D√©marr√©','in')">D√©marrer</button></div></div></div></div>${lc.map(l=>`<div class="pick ${l.ct!==null?(l.ct===l.th?'ok':''):'wt'}"><div class="pick-s ${l.ct!==null?(l.ct===l.th?'g':'w'):'w'}">${l.ct!==null?(l.ct===l.th?'‚úì':'!'):'?'}</div><div style="flex:1"><div class="loc">${l.l}</div><div class="fw6 mt4">${l.p}</div><div class="xs muted">Th√©orique : ${l.th}</div></div><div class="tr">${l.ct!==null?`<span class="mono fw6" style="color:${l.ct===l.th?'var(--gn)':'var(--rd)'}">Comptage : ${l.ct}</span>`:'<input type="number" placeholder="Count" style="width:70px;text-align:center;border:1.5px solid var(--bd);border-radius:4px;padding:6px;font-size:16px;font-family:var(--mo)">'}</div></div>`).join('')}<div class="flex-b mt16"><span class="xs muted">2/3 compt√©s</span><button class="btn btn-gn" onclick="toast('Valid√©','ok')">Valider</button></div>`};
G.invoices=function(){cr('Factures');
const rows=IV.map(i=>`<tr class="ck" onclick="go('inv-d','${i.id}')"><td class="mono fw6">${i.n}</td><td>${i.cu}</td><td>${bd(i.st)}</td><td class="mono tr">${E(i.ht)}</td><td class="mono tr">${E(i.vat)}</td><td class="mono tr fw6">${E(i.ttc)}</td><td class="muted">${i.dt}</td></tr>`).join('');
return `<div class="page-head"><div><h1>Factures</h1><p class="desc">${IV.length}</p></div>${R==='ACCOUNTING'?'<button class="btn btn-gh">Export FEC</button>':''}</div><div class="card"><div class="tbar"><div class="filters"><input class="fi" placeholder="Rechercher‚Ä¶" oninput="filt('inv-t',this)"><select class="fi"><option>Tous</option><option>ISSUED</option><option>SENT</option><option>PAID</option></select></div></div><div class="tw"><table id="inv-t"><thead><tr><th>N¬∞ Facture</th><th>Client</th><th>Statut</th><th class="tr">HT</th><th class="tr">TVA</th><th class="tr">TTC</th><th>Date</th></tr></thead><tbody>${rows}</tbody></table></div></div>`};

G['inv-d']=function(id){const i=IV.find(x=>x.id===id)||IV[0];cr('Factures',i.n);
return `<div class="page-head"><div><h1>${i.n}</h1><p class="desc">${i.cu} ¬∑ ${i.dt}</p></div><div class="actions"><button class="btn btn-gh" onclick="go('invoices')">‚Üê Retour</button><button class="btn btn-gh" onclick="toast('PDF t√©l√©charg√©','ok')">üìÑ PDF</button>${i.st==='ISSUED'?'<button class="btn btn-bl" onclick="toast(\'Sent to customer\',\'ok\')">üìß Envoyer</button>':''}</div></div>
<div class="row21"><div><div class="card"><div class="ch"><span class="ct">D√©tails</span>${bd(i.st)}</div><div class="cb"><div class="dg"><div class="dl">N¬∞ Facture</div><div class="dv mono fw7">${i.n}</div><div class="dl">Client</div><div class="dv"><span class="link" onclick="go('cust-d','${CU.find(c=>c.nm===i.cu)?.id||'C1'}')">${i.cu}</span></div><div class="dl">Commande</div><div class="dv mono">${i.ord}</div><div class="dl">Date</div><div class="dv">${i.dt}</div></div></div></div>
<div class="card"><div class="ch"><span class="ct">Lignes</span></div><div class="cb np"><table><thead><tr><th>Produit</th><th class="tr">Qt√©</th><th class="tr">Unit√©</th><th class="tr">Total</th></tr></thead><tbody><tr><td class="fw6">Plaquettes Brembo P06075</td><td class="mono tr">2</td><td class="mono tr">787.50 ‚Ç¨</td><td class="mono tr fw6">90.00 ‚Ç¨</td></tr><tr><td class="fw6">Filtre Mann HU716/2x</td><td class="mono tr">4</td><td class="mono tr">12.50 ‚Ç¨</td><td class="mono tr fw6">50.00 ‚Ç¨</td></tr></tbody></table></div></div></div>
<div><div class="card"><div class="ch"><span class="ct">Totaux</span></div><div class="cb"><div class="dg"><div class="dl">HT</div><div class="dv mono">${E(i.ht)}</div><div class="dl">TVA (20%)</div><div class="dv mono">${E(i.vat)}</div></div><div class="flex-b mt8" style="font-size:18px;font-weight:700;padding-top:12px;border-top:2px solid var(--t1)"><span>TTC</span><span class="mono">${E(i.ttc)}</span></div></div></div></div></div>`};

G['credit-notes']=function(){cr('Avoirs');return `<div class="page-head"><div><h1>Avoirs</h1></div></div><div class="card"><div class="tw"><table><thead><tr><th>N¬∞ Avoir</th><th>Facture</th><th>Client</th><th class="tr">HT</th><th class="tr">TTC</th><th>Date</th></tr></thead><tbody><tr><td class="mono fw6">AVO-2026-0007</td><td class="mono">INV-00095</td><td>Garage Dupont</td><td class="mono tr">787.50 ‚Ç¨</td><td class="mono tr fw6">945 ‚Ç¨</td><td class="muted">2026-02-08</td></tr><tr><td class="mono fw6">AVO-2026-0008</td><td class="mono">INV-00098</td><td>Garage Martin</td><td class="mono tr">32.00 ‚Ç¨</td><td class="mono tr fw6">38.40 ‚Ç¨</td><td class="muted">2026-02-10</td></tr></tbody></table></div></div>`};

G.returns=function(){cr('Retours');return `<div class="page-head"><div><h1>Retours</h1></div>${['COUNTER_AGENT','MANAGER','OWNER'].includes(R)?'<button class="btn btn-ac" onclick="toast(\'New return\',\'in\')">+ Nouveau</button>':''}</div><div class="card"><div class="tw"><table><thead><tr><th>N¬∞ Retour</th><th>Client</th><th>Commande</th><th>Statut</th><th>Motif</th><th class="tr">Montant</th><th></th></tr></thead><tbody><tr><td class="mono fw6">RET-0012</td><td>Garage Dupont</td><td class="mono">ORD-00180</td><td>${bd('APPROVED')}</td><td class="xs">Mauvaise r√©f</td><td class="mono tr">787.50 ‚Ç¨</td><td></td></tr><tr><td class="mono fw6">RET-0013</td><td>Garage Martin</td><td class="mono">ORD-00179</td><td>${bd('REQUESTED')}</td><td class="xs">Endommag√©</td><td class="mono tr">129.00 ‚Ç¨</td><td>${['MANAGER','OWNER','ADMIN'].includes(R)?'<button class="btn btn-xs btn-gn" onclick="toast(\'Approved\',\'ok\')">Approuver</button>':''}</td></tr></tbody></table></div></div>`};

G['sup-ret']=function(){cr('Retours Fournisseurs');return `<div class="page-head"><div><h1>Retours Fournisseurs (BRF)</h1></div></div><div class="card"><div class="tw"><table><thead><tr><th>N¬∞ BRF</th><th>Fournisseur</th><th>PO</th><th>Statut</th><th>Motif</th><th class="tr">HT</th></tr></thead><tbody><tr><td class="mono fw6">BRF-0005</td><td>AutoPartner</td><td class="mono">PO-00038</td><td>${bd('SHIPPED')}</td><td>Endommag√©</td><td class="mono tr">48.00 ‚Ç¨</td></tr><tr><td class="mono fw6">BRF-0006</td><td>Ridex</td><td class="mono">PO-00041</td><td>${bd('CREATED')}</td><td>Mauvaise r√©f</td><td class="mono tr">22.50 ‚Ç¨</td></tr></tbody></table></div></div>`};

G.ocr=function(){cr('Import OCR');return `<div class="page-head"><div><h1>üßæ Import OCR</h1></div><button class="btn btn-ac" onclick="toast('Upload','in')">+ T√©l√©verser</button></div><div class="al al-w mb16">‚ö†Ô∏è 1 √©cart</div><div class="card"><div class="tw"><table><thead><tr><th>Fournisseur</th><th>Facture</th><th>PO</th><th>Statut</th><th class="tr">HT</th><th>√âcart</th></tr></thead><tbody><tr><td>Ridex</td><td class="mono fw6">FA-RX-1234</td><td class="mono">PO-00042</td><td>${bd('VALIDATED')}</td><td class="mono tr">85.00 ‚Ç¨</td><td><span class="b b-gn">OK</span></td></tr><tr><td>AutoPartner</td><td class="mono fw6">FA-AP-211</td><td class="mono">PO-00038</td><td>${bd('IMPORTED')}</td><td class="mono tr">192.00 ‚Ç¨</td><td><span class="b b-rd">√âCART</span></td></tr></tbody></table></div></div>`};

G.discounts=function(){cr('Remises');return `<div class="page-head"><div><h1>üè∑Ô∏è Remises</h1></div></div><div class="card mb16"><div class="ch"><span class="ct">ORD-2026-00187</span>${bd('PENDING_APPROVAL')}</div><div class="cb"><div class="dg mb16"><div class="dl">Client</div><div class="dv fw6">Garage Martin</div><div class="dl">Type</div><div class="dv">POURCENTAGE</div><div class="dl">Valeur</div><div class="dv fw7">12%</div><div class="dl">Montant</div><div class="dv mono fw7">144.00 ‚Ç¨</div><div class="dl">Motif</div><div class="dv">Client fid√®le, volume</div><div class="dl">Par</div><div class="dv">Sarah ¬∑ 10:30</div></div>${['OWNER','MANAGER','ADMIN'].includes(R)?`<div class="fg"><label>Motif</label><textarea class="fi" rows="2" style="width:100%"></textarea></div><div class="flex gap8"><button class="btn btn-gn" onclick="toast('Approuv√©','ok')">‚úì Approuver</button><button class="btn btn-rd" onclick="toast('Rejet√©','wn')">‚úï Rejeter</button></div>`:''}</div></div><div class="card"><div class="ch"><span class="ct">ORD-2026-00182</span>${bd('APPROVED')}</div><div class="cb"><div class="dg"><div class="dl">Client</div><div class="dv">Auto Mercier</div><div class="dl">Montant</div><div class="dv mono">50 ‚Ç¨ fixe</div><div class="dl">Approuv√©</div><div class="dv">Marie Dupuis</div></div></div></div>`};

G['pos-page']=function(){cr('Caisse');
const rows=TK.map(t=>`<tr><td class="mono fw6">${t.n}</td><td>${t.t}</td><td>${t.c}</td><td class="tr">${t.it}</td><td class="mono tr fw6">${E(t.ttc)}</td><td>${t.m==='MIXED'?'<span class="b b-bl">MIXED</span>':t.m==='CARD'?'<span class="b b-gn">CARD</span>':'<span class="b b-gr">CASH</span>'}</td></tr>`).join('');
return `<div class="page-head"><div><h1>üí≥ Caisse POS</h1><p class="desc">Register ${POS_OPEN?'OUVERTE depuis 08:02':'CLOSED'}</p></div><div class="actions">${POS_OPEN?'<button class="btn btn-rd" onclick="showCfm(\'Fermer Caisse?\',\'Saisissez le montant esp√®ces pour l&#39;√©cart\',()=>{POS_OPEN=false;toast(\'Ferm√©e ¬∑ 0 ‚Ç¨ √©cart\',\'ok\');go(\'pos-page\')})">Fermer</button>':'<button class="btn btn-gn" onclick="POS_OPEN=true;toast(\'Caisse ouverte\',\'ok\');go(\'pos-page\')">Ouvrir Caisse</button>'}</div></div>
${POS_OPEN?`<div class="stats"><div class="stat"><div class="s-icon a">üí≥</div><div class="s-label">CB</div><div class="s-val">14 280 ‚Ç¨</div></div><div class="stat"><div class="s-icon g">üíµ</div><div class="s-label">Esp√®ces</div><div class="s-val">7 570 ‚Ç¨</div></div><div class="stat"><div class="s-icon b">üìä</div><div class="s-label">Total</div><div class="s-val">21 850 ‚Ç¨</div></div><div class="stat"><div class="s-icon o">üé´</div><div class="s-label">Tickets</div><div class="s-val">72</div></div></div><div class="card"><div class="ch"><span class="ct">Tickets</span></div><div class="tw"><table><thead><tr><th>Ticket</th><th>Heure</th><th>Client</th><th class="tr">Articles</th><th class="tr">Total</th><th>Paiement</th></tr></thead><tbody>${rows}</tbody></table></div></div>`:'<div class="empty"><div class="ei">üîí</div><h3>Caisse Ferm√©e</h3><p>Ouvrez la caisse pour commencer √† vendre</p></div>'}`};

G.users=function(){cr('Utilisateurs');const list=[{n:'Nabil Bouzid',e:'nabilbouzid@mecadepot.fr',r:'OWNER'},{n:'Marie Dupuis',e:'marie@mecadepot.fr',r:'MANAGER'},{n:'Sarah Vendeuse',e:'sarah@mecadepot.fr',r:'COUNTER_AGENT'},{n:'Karim Entrepot',e:'karim@mecadepot.fr',r:'WAREHOUSE_KEEPER'},{n:'Nabil Bouzid',e:'nabil@mecadepot.fr',r:'PURCHASER'},{n:'Claire Compta',e:'compta@mecadepot.fr',r:'ACCOUNTING'},{n:'Nabil Bouzid',e:'nabil@mecadepot.fr',r:'ADMIN'}];return `<div class="page-head"><div><h1>Utilisateurs</h1></div>${R==='ADMIN'?'<button class="btn btn-ac">+ Cr√©er</button>':''}</div><div class="card"><div class="tw"><table><thead><tr><th>Nom</th><th>Email</th><th>R√¥le</th><th>Statut</th></tr></thead><tbody>${list.map(u=>`<tr><td class="fw6">${u.n}</td><td class="mono sm">${u.e}</td><td>${bd(u.r)}</td><td>${bd('ACTIVE')}</td></tr>`).join('')}</tbody></table></div></div>`};

G.pricing=function(){cr('Pricing');const GR=[{n:'Gold',g:10,c:2},{n:'Silver',g:7,c:1},{n:'Standard',g:5,c:2},{n:'Public',g:0,c:0}];return `<div class="page-head"><div><h1>Grilles Tarifaires</h1><p class="desc">3 niveaux</p></div><button class="btn btn-ac">+ Cr√©er</button></div>${GR.map(g=>`<div class="card mb16"><div class="ch"><span class="ct">${g.n}</span><span class="b b-gr">${g.c} clients</span></div><div class="cb"><div class="row3"><div><div class="s-label">Global</div><div style="font-size:22px;font-weight:700;font-family:var(--mo);margin-top:4px">${g.g}%</div></div><div><div class="s-label">Par fournisseur</div><div class="mt4">${g.g>7?'<div class="sm">Ridex: 12%</div><div class="sm">AutoPartner: 10%</div>':g.g>5?'<div class="sm">Ridex: 8%</div>':'<span class="xs muted">‚Äî</span>'}</div></div><div><div class="s-label">Par cat√©gorie</div><div class="mt4">${g.g>7?'<div class="sm">Freinage: 15%</div><div class="sm">Filtration: 12%</div>':g.g>5?'<div class="sm">Freinage: 10%</div>':'<span class="xs muted">‚Äî</span>'}</div></div></div></div></div>`).join('')}`};

G.settings=function(){cr('Param√®tres');return `<div class="page-head"><div><h1>‚öôÔ∏è Param√®tres</h1></div></div><div class="card"><div class="cb"><div class="grid-f"><div class="fg"><label>TVA %</label><input type="number" value="20" class="fi" style="width:100%"></div><div class="fg"><label>Approbation auto (‚Ç¨)</label><input type="number" value="500" class="fi" style="width:100%"></div><div class="fg"><label>Max utilisateurs B2B</label><input type="number" value="5" class="fi" style="width:100%"></div><div class="fg"><label>Pr√©fixe Facture</label><input value="INV" class="fi" style="width:100%"></div><div class="fg"><label>Validit√© Devis (jours)</label><input type="number" value="30" class="fi" style="width:100%"></div><div class="fg"><label>D√©lai Retour (jours)</label><input type="number" value="30" class="fi" style="width:100%"></div></div><div class="mt16"><button class="btn btn-ac" onclick="toast('Enregistr√©','ok')">Enregistrer</button></div></div></div>`};

G['b2b-dash']=function(){cr('Portail','Tableau de bord');return `<div class="page-head"><div><h1>Bienvenue, ${U[R].co||'Soci√©t√©'}</h1></div></div><div class="stats"><div class="stat"><div class="s-icon b">üõí</div><div class="s-label">Commandes</div><div class="s-val">12</div></div><div class="stat"><div class="s-icon g">üìÑ</div><div class="s-label">Factures</div><div class="s-val">8</div></div><div class="stat"><div class="s-icon a">üí∞</div><div class="s-label">Grille</div><div class="s-val">Gold</div><div class="s-ch">-10%</div></div></div><div class="card"><div class="ch"><span class="ct">Commandes r√©centes</span><button class="btn-link" onclick="go('b2b-ord')">Voir tout ‚Üí</button></div><div class="cb np"><table><thead><tr><th>Commande</th><th>Statut</th><th class="tr">Total</th><th>Date</th></tr></thead><tbody>${OD.filter(o=>o.cu==='Garage Martin').map(o=>`<tr><td class="mono fw6">${o.n}</td><td>${bd(o.st)}</td><td class="mono tr fw6">${E(o.ttc)}</td><td class="muted">${o.dt}</td></tr>`).join('')}</tbody></table></div></div>`};

G['b2b-cat']=function(){cr('Portail','Catalogue');
const articles=[
{nm:'Plaquettes frein Brembo P06075',br:'Brembo',ct:'Freinage',stk:12,ld:'Stock',pr:40.50},
{nm:'Filtre huile Mann HU716/2x',br:'Mann-Filter',ct:'Filtration',stk:4,ld:'Stock',pr:11.25},
{nm:'Bougie Bosch 0242236571',br:'Bosch',ct:'Allumage',stk:44,ld:'Stock',pr:8.01},
{nm:'Huile Total Quartz 5W-40 5L',br:'Total',ct:'Lubrifiants',stk:16,ld:'Stock',pr:46.80},
{nm:'Balai Bosch A933S',br:'Bosch',ct:'Essuyage',stk:35,ld:'Stock',pr:26.91},
{nm:'Disque frein Brembo 09.A820.11',br:'Brembo',ct:'Freinage',stk:0,ld:'J+1',pr:61.20,sup:'Ridex'},
{nm:'Courroie Gates K015603XS',br:'Gates',ct:'Distribution',stk:0,ld:'J+1',pr:148.50,sup:'AutoPartner'},
{nm:'Amortisseur Sachs 314700',br:'Sachs',ct:'Suspension',stk:0,ld:'J+1',pr:85.50,sup:'PSH'},
{nm:'Batterie Varta Blue E11 74Ah',br:'Varta',ct:'√âlectricit√©',stk:0,ld:'J+1',pr:116.10,sup:'PSH'},
{nm:'Support moteur Febi 23918',br:'Febi',ct:'Moteur',stk:0,ld:'J+1',pr:52.20,sup:'AutoPartner'},
{nm:'Kit embrayage Valeo 826729',br:'Valeo',ct:'Embrayage',stk:0,ld:'J+2',pr:189.00,sup:'AJS'},
{nm:'Pompe √† eau SKF VKPC 85101',br:'SKF',ct:'Refroid.',stk:0,ld:'J+2',pr:67.50,sup:'InterCar'},
{nm:'Compresseur clim Denso DCP17068',br:'Denso',ct:'Climatisation',stk:0,ld:'J+2',pr:315.00,sup:'AJS'},
{nm:'Turbo Garrett 760774-5003S',br:'Garrett',ct:'Turbo',stk:0,ld:'J+2',pr:580.00,sup:'InterCar'}
];
const rows=articles.map(p=>{
const avail=p.ld==='Stock'?'<span class="src src-i">'+p.stk+' en Stock</span>':p.ld==='J+1'?'<span class="b b-bl">J+1</span> <span class="xs muted">'+p.sup+'</span>':'<span class="b b-or">J+2</span> <span class="xs muted">'+p.sup+'</span>';
return `<tr><td><div class="fw6">${p.nm}</div><div class="xs muted">${p.br} ¬∑ ${p.ct}</div></td><td>${avail}</td><td class="mono tr">${E(p.pr)}</td><td class="mono tr fw6">${E(p.pr*1.2)}</td><td>${R!=='B2B_VIEWER'?`<button class="btn btn-xs btn-ac" onclick="CART.push({nm:'${p.nm.replace(/'/g,"\\'")}',pr:${p.pr.toFixed(2)}});toast('Added ('+CART.length+')','ok')">Ajouter</button>`:''}</td></tr>`}).join('');
return `<div class="page-head"><div><h1>Catalogue</h1><p class="desc">Grille Gold (-10%) ¬∑ ${articles.length} produits</p></div>${R!=='B2B_VIEWER'?`<button class="btn btn-ac" onclick="go('b2b-cart')">üõí Panier (<span id="b2b-cnt">${CART.length}</span>)</button>`:''}</div>
<div class="card mb16"><div class="cb"><div class="inline-f"><div class="fg"><input class="fi" placeholder="Rechercher produits‚Ä¶" oninput="filt('b2bcat',this)" style="width:100%"></div><div class="fg" style="flex:0"><select class="fi"><option>Toutes les dispo.</option><option>En stock</option><option>J+1</option><option>J+2</option></select></div><div class="fg" style="flex:0"><button class="btn btn-gh">üöó V√©hicule</button></div><div class="fg" style="flex:0"><button class="btn btn-ac">Rechercher</button></div></div></div></div>
<div class="al al-i mb16">üí° <strong>En stock</strong> = imm√©diat ¬∑ <strong>J+1</strong> = jour ouvr√© suivant ¬∑ <strong>J+2</strong> = 2 jours ouvr√©s (fournisseur d√©lai plus long)</div>
<div class="card"><div class="tw"><table id="b2bcat"><thead><tr><th>Produit</th><th>Disponibilit√©</th><th class="tr">Votre Prix HT</th><th class="tr">TTC</th><th></th></tr></thead><tbody>${rows}</tbody></table></div><div class="tfoot"><span>${articles.filter(i=>i.ld==='Stock').length} en stock ¬∑ ${articles.filter(i=>i.ld==='J+1').length} √† J+1 ¬∑ ${articles.filter(i=>i.ld==='J+2').length} √† J+2</span></div></div>`};

G['b2b-cart']=function(){cr('Portail','Panier');
if(!CART.length)return `<div class="page-head"><div><h1>üõí Panier</h1></div><button class="btn btn-gh" onclick="go('b2b-cat')">‚Üê Catalogue</button></div><div class="empty"><div class="ei">üõí</div><h3>Le panier est vide</h3><p>Ajoutez des produits depuis le catalogue</p><button class="btn btn-ac" onclick="go('b2b-cat')">Parcourir Catalogue</button></div>`;
const ttHT=CART.reduce((s,c)=>s+c.pr,0);
return `<div class="page-head"><div><h1>üõí Panier</h1><p class="desc">${CART.length} articles</p></div><button class="btn btn-gh" onclick="go('b2b-cat')">‚Üê Catalogue</button></div>
<div class="row21"><div><div class="card"><div class="cb np"><table><thead><tr><th>Produit</th><th class="tr">HT</th><th></th></tr></thead><tbody>${CART.map((c,i)=>`<tr><td class="fw6">${c.nm}</td><td class="mono tr">${E(c.pr)}</td><td><button class="btn-link" style="color:var(--rd)" onclick="CART.splice(${i},1);go('b2b-cart')">‚úï</button></td></tr>`).join('')}</tbody></table></div></div></div>
<div><div class="card"><div class="ch"><span class="ct">R√©sum√©</span></div><div class="cb"><div class="dg"><div class="dl">HT</div><div class="dv mono">${E(ttHT)}</div><div class="dl">TVA</div><div class="dv mono">${E(ttHT*.2)}</div></div><div class="flex-b mt8" style="font-size:18px;font-weight:700;padding-top:12px;border-top:2px solid var(--t1)"><span>TTC</span><span class="mono">${E(ttHT*1.2)}</span></div><button class="btn btn-ac btn-full mt16" onclick="CART=[];toast('Commande pass√©e','ok');go('b2b-ord')">Passer Commande</button><button class="btn btn-gh btn-full mt8" onclick="CART=[];go('b2b-cat')">Vider</button></div></div></div></div>`};

G['b2b-ord']=function(){cr('Portail','Commandes');return `<div class="page-head"><div><h1>Mes Commandes</h1></div></div><div class="card"><div class="tw"><table><thead><tr><th>Commande</th><th>Statut</th><th class="tr">Total</th><th>Date</th></tr></thead><tbody>${OD.filter(o=>o.cu==='Garage Martin').map(o=>`<tr><td class="mono fw6">${o.n}</td><td>${bd(o.st)}</td><td class="mono tr fw6">${E(o.ttc)}</td><td class="muted">${o.dt}</td></tr>`).join('')}</tbody></table></div></div>`};

G['b2b-inv']=function(){cr('Portail','Factures');return `<div class="page-head"><div><h1>Factures</h1></div></div><div class="card"><div class="tw"><table><thead><tr><th>Facture</th><th>Statut</th><th class="tr">TTC</th><th>Date</th><th></th></tr></thead><tbody>${IV.filter(i=>i.cu==='Garage Martin').map(i=>`<tr><td class="mono fw6">${i.n}</td><td>${bd(i.st)}</td><td class="mono tr fw6">${E(i.ttc)}</td><td class="muted">${i.dt}</td><td><button class="btn btn-xs btn-gh">üìÑ</button></td></tr>`).join('')}</tbody></table></div></div>`};

G['b2b-pro']=function(){cr('Portail','Profil');return `<div class="page-head"><div><h1>Soci√©t√©</h1></div></div><div class="card"><div class="cb"><div class="dg"><div class="dl">Soci√©t√©</div><div class="dv fw6">Garage Martin</div><div class="dl">SIRET</div><div class="dv mono">12345678901234</div><div class="dl">Grille</div><div class="dv">Gold (-10%)</div><div class="dl">Utilisateurs</div><div class="dv">3/5</div><div class="dl">R√¥le</div><div class="dv">${bd(R)}</div></div></div></div>`};

G['sup-compare']=function(){cr('Achats','Comparateur Fournisseurs');
const parts=[
{ref:'BRK-001',nm:'Plaquettes Brembo P06075',ct:'Freinage',sups:[
{s:'Ridex',pr:21.38,stk:45,ld:'J+1',best:1},{s:'AutoPartner',pr:23.63,stk:22,ld:'J+1',best:0},{s:'PSH',pr:22.95,stk:18,ld:'J+1',best:0},{s:'AJS',pr:24.50,stk:30,ld:'J+2',best:0},{s:'InterCar',pr:25.10,stk:0,ld:'‚Äî',best:0,err:'Indisponible'}]},
{ref:'DSK-019',nm:'Disque Brembo 09.A820.11',ct:'Freinage',sups:[
{s:'Ridex',pr:30.40,stk:12,ld:'J+1',best:0},{s:'AutoPartner',pr:33.60,stk:8,ld:'J+1',best:0},{s:'PSH',pr:29.44,stk:18,ld:'J+1',best:1},{s:'AJS',pr:31.00,stk:5,ld:'J+2',best:0},{s:'InterCar',pr:34.50,stk:15,ld:'J+2',best:0}]},
{ref:'FLT-042',nm:'Filtre Mann HU716/2x',ct:'Filtration',sups:[
{s:'Ridex',pr:5.80,stk:60,ld:'J+1',best:0},{s:'AutoPartner',pr:5.51,stk:40,ld:'J+1',best:1},{s:'PSH',pr:6.10,stk:25,ld:'J+1',best:0},{s:'AJS',pr:5.90,stk:0,ld:'‚Äî',best:0,err:'Rupture de stock'},{s:'InterCar',pr:6.50,stk:50,ld:'J+2',best:0}]},
{ref:'BAT-005',nm:'Batterie Varta E11 74Ah',ct:'√âlectricit√©',sups:[
{s:'Ridex',pr:62.00,stk:8,ld:'J+1',best:0},{s:'AutoPartner',pr:0,stk:0,ld:'‚Äî',best:0,err:'Non r√©f√©renc√©'},{s:'PSH',pr:59.80,stk:4,ld:'J+1',best:1},{s:'AJS',pr:64.00,stk:12,ld:'J+2',best:0},{s:'InterCar',pr:58.50,stk:3,ld:'J+2',best:0}]}
];
return `<div class="page-head"><div><h1>‚öñÔ∏è Comparaison Prix Fournisseurs</h1><p class="desc">SCR-SUP-002 ¬∑ Interrogation parall√®le de tous les fournisseurs actifs</p></div></div>
<div class="card mb16"><div class="ch"><span class="ct">Recherche Pi√®ces</span></div><div class="cb"><div class="inline-f mb8"><div class="fg"><label>R√©f√©rence(s) pi√®ce</label><input class="fi" style="width:100%" value="BRK-001, DSK-019, FLT-042, BAT-005" placeholder="Entrez les r√©fs s√©par√©es par virgule, ou collez en masse‚Ä¶"></div><div class="fg" style="flex:0"><label>&nbsp;</label><button class="btn btn-ac" onclick="toast('Interrogation 5 fournisseurs‚Ä¶','in')">‚öñÔ∏è Compare</button></div><div class="fg" style="flex:0"><label>&nbsp;</label><button class="btn btn-gh" onclick="toast('Import depuis alertes stock','in')">Importer Alertes</button></div></div><div class="xs muted">Supports : r√©f interne, num√©ro OEM, r√©f TecCom ¬∑ Collage en masse ou import depuis alertes stock</div></div></div>
<div class="al al-ok mb16">‚úÖ 5 fournisseurs interrog√©s ¬∑ 4 pi√®ces trouv√©es ¬∑ <strong>1 indisponibilit√©</strong> (AJS : FLT-042 rupture de stock)</div>
${parts.map(p=>{
const best=p.sups.find(s=>s.best);
return `<div class="card mb16"><div class="ch"><span class="ct">${p.ref} ‚Äî ${p.nm}</span><span class="b b-gr">${p.ct}</span></div><div class="cb np"><div class="tw"><table><thead><tr><th>Fournisseur</th><th class="tr">Prix unit. HT</th><th class="tr">vs Meilleur</th><th class="tr">Dispo.</th><th>D√©lai</th><th class="tc">Choisir</th></tr></thead><tbody>${p.sups.map(s=>{
const diff=best&&s.pr>0?((s.pr-best.pr)/best.pr*100).toFixed(1):'‚Äî';
return s.err?`<tr style="opacity:.5"><td class="fw6">${s.s}</td><td class="mono tr muted">‚Äî</td><td class="tr">‚Äî</td><td class="mono tr muted">0</td><td><span class="b b-rd">${s.err}</span></td><td class="tc">‚Äî</td></tr>`:`<tr${s.best?' style="background:var(--gnl)"':''}><td class="fw6">${s.s}${s.best?' <span class="b b-gn">BEST</span>':''}</td><td class="mono tr fw6${s.best?' style="color:var(--gn)"':''}">${E(s.pr)}</td><td class="mono tr xs ${diff==='0.0'?'':'sec'}">${diff==='0.0'?'‚Äî':'+'+diff+'%'}</td><td class="mono tr">${s.stk}</td><td>${s.ld==='J+1'?'<span class="b b-bl">J+1</span>':'<span class="b b-or">J+2</span>'}</td><td class="tc"><input type="radio" name="sel_${p.ref}"${s.best?' checked':''}></td></tr>`}).join('')}</tbody></table></div></div></div>`}).join('')}
<div class="flex-b"><div><span class="fw6">4 pi√®ces s√©lectionn√©es</span> ¬∑ <span class="muted">de 3 fournisseurs</span></div><div class="flex gap8"><button class="btn btn-gh">Tri par prix</button><button class="btn btn-gh">Tri par d√©lai</button><button class="btn btn-ac" onclick="toast('BC cr√©√©s par fournisseur ‚Äî 3 BC g√©n√©r√©s','ok');go('po')">Cr√©er Bons de Commande ‚Üí</button></div></div>`};

G['stock-alerts']=function(){cr('Achats','Alertes Stock');
const alerts=[
{p:'Kit plaquettes Bosch 0986494524',sk:'BRK-045',ct:'Freinage',stk:2,thr:5,sev:'URGENT',ack:0,dt:'13/02 10:15'},
{p:'Filtre huile Mann HU716/2x',sk:'FLT-042',ct:'Filtration',stk:4,thr:8,sev:'NORMAL',ack:1,dt:'13/02 08:30',by:'Nabil'},
{p:'Disque frein Brembo 09.A820.11',sk:'DSK-019',ct:'Freinage',stk:0,thr:3,sev:'OUT_OF_STOCK',ack:0,dt:'12/02 17:45'},
{p:'Batterie Varta Blue E11',sk:'BAT-005',ct:'√âlectricit√©',stk:3,thr:3,sev:'URGENT',ack:0,dt:'13/02 07:00'},
{p:'Courroie Gates K015603XS',sk:'BLT-003',ct:'Distribution',stk:5,thr:4,sev:'RESOLVED',ack:1,dt:'12/02 15:20',by:'Nabil'}
];
const open=alerts.filter(a=>a.sev!=='RESOLVED');
return `<div class="page-head"><div><h1>üö® Tableau Alertes Stock</h1><p class="desc">SCR-SUP-006 ¬∑ ${open.length} alertes actives</p></div><button class="btn btn-ac" onclick="go('sup-compare')">‚öñÔ∏è Tout Comparer ‚Üí</button></div>
<div class="stats"><div class="stat"><div class="s-icon r">üî¥</div><div class="s-label">Rupture</div><div class="s-val">${alerts.filter(a=>a.sev==='OUT_OF_STOCK').length}</div></div><div class="stat"><div class="s-icon o">üü†</div><div class="s-label">Urgent</div><div class="s-val">${alerts.filter(a=>a.sev==='URGENT').length}</div></div><div class="stat"><div class="s-icon b">üîµ</div><div class="s-label">Normal</div><div class="s-val">${alerts.filter(a=>a.sev==='NORMAL').length}</div></div><div class="stat"><div class="s-icon g">‚úÖ</div><div class="s-label">R√©solu</div><div class="s-val">${alerts.filter(a=>a.sev==='RESOLVED').length}</div></div></div>
<div class="card"><div class="tbar"><div class="filters"><input class="fi" placeholder="Rechercher‚Ä¶" oninput="filt('sal-t',this)"><select class="fi"><option>Actif seulement</option><option>Tous</option><option>OUT_OF_STOCK</option><option>URGENT</option><option>NORMAL</option></select></div></div><div class="tw"><table id="sal-t"><thead><tr><th>S√©v√©rit√©</th><th>Produit</th><th>Cat√©gorie</th><th class="tr">Stock</th><th class="tr">Seuil</th><th>D√©clench√©</th><th>Statut</th><th></th></tr></thead><tbody>${alerts.map(a=>`<tr><td>${bd(a.sev)}</td><td><div class="fw6">${a.p}</div><div class="xs muted">${a.sk}</div></td><td>${a.ct}</td><td class="mono tr fw6" style="color:${a.stk===0?'var(--rd)':a.stk<=a.thr?'var(--or)':'var(--gn)'}">${a.stk}</td><td class="mono tr">${a.thr}</td><td class="xs muted">${a.dt}</td><td>${a.ack?`<span class="b b-bl">Pris en charge par ${a.by}</span>`:'<span class="b b-or">NOUVEAU</span>'}</td><td>${a.sev!=='RESOLVED'?`<div class="flex gap4"><button class="btn btn-xs btn-ac" onclick="go('sup-compare')">‚öñÔ∏è</button>${!a.ack?`<button class="btn btn-xs btn-gh" onclick="toast('Pris en charge','ok')">Prise en charge</button>`:''}${['OWNER','ADMIN','MANAGER'].includes(R)?`<button class="btn btn-xs btn-gh" onclick="toast('Seuil mis √† jour','ok')">Modifier</button>`:''}</div>`:''}</td></tr>`).join('')}</tbody></table></div></div>
<div class="al al-i mt16">‚ÑπÔ∏è Les alertes sont g√©n√©r√©es √† chaque mouvement de stock. Pas de r√©appro auto ‚Äî utilisez le Comparateur pour cr√©er des BC manuellement.</div>`};

G['discount-matrix']=function(){cr('Administration','Matrice Remises');
var cats=['Freinage','Filtration','Lubrifiants','Suspension','√âlectricit√©','Distribution','Allumage','Essuyage','Moteur','Embrayage','Climatisation','Turbo'];
var groups=[{n:'Gold',c:'#f59e0b'},{n:'Silver',c:'#94a3b8'},{n:'Bronze',c:'#b45309'},{n:'VIP',c:'#8b5cf6'},{n:'Standard',c:'#64748b'},{n:'Nouveau Client',c:'#06b6d4'}];
var mx={Freinage:[20,15,10,25,5,3],Filtration:[15,12,8,20,5,2],Lubrifiants:[12,10,7,18,4,2],Suspension:[18,14,10,22,5,3],√âlectricit√©:[14,11,8,18,5,2],Distribution:[16,12,9,20,5,3],Allumage:[10,8,5,15,3,2],Essuyage:[10,8,5,12,3,1],Moteur:[18,14,10,22,5,3],Embrayage:[16,12,9,20,5,3],Climatisation:[14,10,8,18,5,2],Turbo:[12,10,7,16,4,2]};
var gc=function(v){return v>=15?'var(--gn)':v>=10?'var(--bl)':v>=5?'var(--t1)':'var(--t3)'};
var hd=groups.map(function(g){return '<th class="tc" style="min-width:90px"><span style="display:inline-block;width:8px;height:8px;border-radius:50%;background:'+g.c+';margin-right:4px"></span>'+g.n+'</th>'}).join('');
var rows=cats.map(function(ct){var vals=mx[ct]||[0,0,0,0,0,0];var cells=vals.map(function(v){return '<td class="tc mono fw6" style="cursor:pointer;color:'+gc(v)+'" onclick="editMC(this,'+v+')">'+v+'%</td>'}).join('');return '<tr><td class="fw6" style="position:sticky;left:0;background:var(--card);z-index:1">'+ct+'</td>'+cells+'</tr>'}).join('');
return '<div class="page-head"><div><h1>üí∞ Matrice Remises B2B</h1><p class="desc">SCR-SUP-005 ¬∑ Groupe Acheteur √ó Cat√©gorie ¬∑ 6 groupes √ó 12 cat√©gories</p></div><div class="actions">'+(R==="OWNER"||R==="ADMIN"?'<button class="btn btn-gh" onclick="toast(\'Exported\',\'ok\')">Export CSV</button><button class="btn btn-ac" onclick="toast(\'Saved\',\'ok\')">Enregistrer</button>':'')+'</div></div><div class="al al-i mb16">Prix = Base HT √ó (1 ‚àí Remise%). Cliquer sur une cellule pour modifier.</div><div class="card"><div class="cb np"><div class="tw"><table><thead><tr><th style="position:sticky;left:0;background:var(--inp);z-index:1">Cat√©gorie ‚Üì / Groupe ‚Üí</th>'+hd+'</tr></thead><tbody>'+rows+'</tbody></table></div></div></div><div class="al al-i mt16">Example: Plaquettes frein base = <strong>50 ‚Ç¨ HT</strong> ¬∑ Gold Freinage = <strong>20%</strong> ‚Üí 50 ‚Ç¨ √ó 0.80 = <strong>40 ‚Ç¨ HT</strong></div>'};
function editMC(el,v){if(R!=="OWNER"&&R!=="ADMIN"){toast("Read-only","wn");return}var i=document.createElement("input");i.type="number";i.value=v;i.style="width:50px;text-align:center;border:2px solid var(--ac);border-radius:4px;padding:2px";i.onblur=function(){el.textContent=this.value+"%";toast("Updated","ok")};el.textContent="";el.appendChild(i);i.focus()}
function showProdModal(){openModal(`<div class="mh"><h3>Ajouter Produit</h3><button class="m-x" onclick="closeModal()">‚úï</button></div><div class="mbdy"><div class="grid-f"><div class="fg"><label>SKU *</label><input class="fi" style="width:100%"></div><div class="fg"><label>EAN</label><input class="fi" style="width:100%"></div><div class="fg" style="grid-column:1/-1"><label>Nom *</label><input class="fi" style="width:100%"></div><div class="fg"><label>Marque</label><select class="fi" style="width:100%"><option>Brembo</option><option>Bosch</option></select></div><div class="fg"><label>Cat√©gorie</label><select class="fi" style="width:100%"><option>Freinage</option><option>Filtration</option></select></div><div class="fg"><label>Achat HT</label><input type="number" class="fi" style="width:100%"></div><div class="fg"><label>Vente HT</label><input type="number" class="fi" style="width:100%"></div></div></div><div class="mft"><button class="btn btn-gh" onclick="closeModal()">Annuler</button><button class="btn btn-ac" onclick="toast('Cr√©√©','ok');closeModal()">Cr√©er</button></div>`)}


function showCustModal(){openModal(`<div class="mh"><h3>Nouveau Client B2B</h3><button class="m-x" onclick="closeModal()">‚úï</button></div><div class="mbdy"><div class="al al-i mb12">SC-14 : Cr√©ation Client B2B</div><div class="grid-f"><div class="fg"><label>Soci√©t√© *</label><input class="fi" style="width:100%" placeholder="Garage XYZ"></div><div class="fg"><label>SIRET *</label><input class="fi" style="width:100%" placeholder="14 chiffres"></div><div class="fg"><label>Nom Contact *</label><input class="fi" style="width:100%"></div><div class="fg"><label>Email *</label><input type="email" class="fi" style="width:100%"></div><div class="fg"><label>T√©l√©phone</label><input class="fi" style="width:100%"></div><div class="fg"><label>Ville</label><input class="fi" style="width:100%"></div><div class="fg" style="grid-column:1/-1"><label>Adresse</label><input class="fi" style="width:100%"></div><div class="fg"><label>Grille Tarifaire</label><select class="fi" style="width:100%"><option>Standard (-5%)</option><option>Silver (-7%)</option><option>Gold (-10%)</option></select></div><div class="fg"><label>Commercial</label><select class="fi" style="width:100%"><option>Sarah</option><option>Marie</option></select></div></div></div><div class="mft"><button class="btn btn-gh" onclick="closeModal()">Annuler</button><button class="btn btn-ac" onclick="toast('Client cr√©√© + invitation B2B envoy√©e','ok');closeModal()">Cr√©er Create & Invite Inviter</button></div>`)}

function openDiscModal(){openModal(`<div class="mh"><h3>üè∑Ô∏è Demander Remise</h3><button class="m-x" onclick="closeModal()">‚úï</button></div><div class="mbdy"><div class="al al-i mb12">COUNTER_AGENT : aucune remise autonome</div><div class="fg"><label>Type</label><select class="fi" style="width:100%"><option>POURCENTAGE</option><option>MONTANT FIXE</option></select></div><div class="fg"><label>Valeur</label><input type="number" class="fi" style="width:100%"></div><div class="fg"><label>Motif (min 10 car.) *</label><textarea class="fi" rows="3" style="width:100%"></textarea></div></div><div class="mft"><button class="btn btn-gh" onclick="closeModal()">Annuler</button><button class="btn btn-ac" onclick="toast('Envoy√© ‚Üí EN ATTENTE','wn');closeModal()">Soumettre</button></div>`)}
</script>
</body>
</html>
